                                                   Chapter 2 Page tables

表的工作原理：把用舭凑者分成大小相等的部分，Q轫。牧汩_始制，鹊刂肥窍於0址。使用蔚捻面技巧，在地址空g映射相同的却妫在未嗣鞯捻面保o用舳！

程式流程D   
    
分硬件：     _始               建地址空g：   _始                          物理却娣峙淦鳎     _始
                                           
               ↓                                   ↓                                                 ↓
                  N
              PTE →返回e`                  vmalloc(1840)                                          {用kinit1和kinit2沓跏蓟分配器(3131)

               ↓Y                                  ↓                                                 ↓
 
              分硬件                        setup - kvm(1818)分配壹却骓                        {用freerange
 
               ↓                                   ↓                                                 ↓

             跟Q地址前20位                   {用mappages戆惭b群诵枰的翻g                       函kfree(3164)                                      

               ↓                                   ↓                                                 ↓                                    
               
              面                            {用walkpgdir查找地址                                   Y束
                 
               ↓                                   ↓
               
              Y束                                 Y束       
                      
  

  
Y料Y

分硬件：分硬件使用M地址的前10位磉x褚面目l目。如果面目l目存在，分硬件⑹褂锰M地址的下10字，捻目l目引用的面表面中x褚PTE。每PTE都包含擞位，它告V分硬件如何使用相P的virp地址。在n案（Page 1,Sheet 07)定x了MMU（却婀芾卧）要用到的岛徒Yw
。
 
M程地址空g：kvmalloc（）函档墓δ苁歉淖壹新的面表，在n案（Page 3,Sheet 18)Y它返回setupkvm()函邓生成的值；n案（Page 1,Sheet 2)文件memory layoutM行\算，⑻M地址DQ槲锢淼刂贰

建地址空g：n案（Page 3,Sheet 18)中setupkvm()分配壹却骓肀４骓面目；n案（Page 2,Sheet 17)中mappages（）函⒂成涞揭面表中的壹系列M地址到相的物理地址；n案（Page 1，Sheet 17)中walkpgdir（）函挡檎以地址的PTE地址。然後它初始化PTE以保存相P的物理、所需的嘞(PTE_W和/或PTE_U)，KPTE_P擞橛行УPTE。              
       
代a:sbrk：n案（Page 3 ,Sheet 25)growproc（）函捣峙湟或多物理面，K⑺映射到M程的地址空g的部。

代a:exec：n案（Page 1,Sheet 66)中Exec()函嫡{用amei()函荡蜷_命名的二M制路健n案（Page 2,Sheet 66)的函allocuvm()槊ELF段分配却妫K使用loaduvm()⒚段b入却妗n案（Page 9,sheet 21)的copyout()函椭频蕉Ｖ校⒃]意到o法L的目隧面，K返回- 1。