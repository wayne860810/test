<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        報告主題：Chapter 4. Locking - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/github-gist.min.css" integrity="sha256-tAflq+ymku3Khs+I/WcAneIlafYgDiOQ9stIHH985Wo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/emojify.js/1.1.0/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,600,600italic,300italic,300|Source+Serif+Pro|Source+Code+Pro:400,300,500&subset=latin,latin-ext);.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e7e7e7;border:0}.markdown-body blockquote{padding:0 1em;color:#777;border-left:.25em solid #ddd}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#777}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{padding:0;list-style-type:none}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{max-width:none;vertical-align:text-top;background-color:transparent}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{display:block;float:left;width:auto;padding:7px;margin:13px 0 0;overflow:hidden;border:1px solid #ddd}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{display:block;padding:5px 0 0;clear:both;color:#333}.markdown-body span.align-center{display:block;overflow:hidden;clear:both}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{display:block;overflow:hidden;clear:both}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{padding:0;padding-top:.2em;padding-bottom:.2em;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{letter-spacing:-.2em;content:"\A0"}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f7f7f7;border-radius:3px}.markdown-body pre code,.markdown-body pre tt{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{padding:5px;overflow:hidden;font-size:12px;line-height:1;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{padding:10px 8px 9px;text-align:right;background:#fff;border:0}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{font-weight:700;background:#f8f8f8;border-top:0}.markdown-body kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid #ccc;border-bottom-color:#bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.news .alert .markdown-body blockquote{padding:0 0 0 40px;border:0 none}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle;cursor:default!important}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,sans-serif;padding-top:40px;padding-bottom:40px;max-width:758px;overflow:visible!important}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{text-align:right;position:relative;display:inline-block;cursor:default;z-index:4;padding:0 8px 0 0;min-width:20px;box-sizing:content-box;color:#afafaf!important;border-right:3px solid #6ce26c!important}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-left:none;border-top:none;border-bottom:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-spacing:0;border-collapse:inherit!important}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{overflow:unset;margin-bottom:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram{text-align:center;background-color:inherit;border-radius:0;white-space:inherit}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg{max-width:100%;height:100%}.markdown-body pre>code.wrap{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}.markdown-body .alert>p,.markdown-body .alert>ul{margin-bottom:0}.vimeo,.youtube{cursor:pointer;display:table;text-align:center;background-position:50%;background-repeat:no-repeat;background-size:contain;background-color:#000;overflow:hidden}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{width:100%;object-fit:contain;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{width:100%;height:100%;position:absolute;top:0;left:0}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{position:absolute;height:auto;width:auto;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;opacity:.3;transition:opacity .2s;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%}.MJX_Assistive_MathML{display:none}.ui-infobar{position:relative;z-index:2;max-width:758px;margin-top:25px;margin-bottom:-25px;color:#777}.ui-toc{position:fixed;bottom:20px;z-index:10000}.ui-toc-label{opacity:.3;background-color:#ccc;border:none;transition:opacity .2s}.ui-toc .open .ui-toc-label{opacity:1;color:#fff;transition:opacity .2s}.ui-toc-label:focus{opacity:.3;background-color:#ccc;color:#000}.ui-toc-label:hover{opacity:1;background-color:#ccc;transition:opacity .2s}.ui-toc-dropdown{margin-top:23px;margin-bottom:20px;padding-left:10px;padding-right:10px;max-width:45vw;width:25vw;max-height:70vh;overflow:auto;text-align:inherit}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{padding-right:0;letter-spacing:.0029em}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{display:block;padding:4px 20px;font-size:13px;font-weight:500;color:#767676}.ui-toc-dropdown .nav>li:first-child:last-child > ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{padding-left:19px;color:#000;text-decoration:none;background-color:transparent;border-left:1px solid #000}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{padding-right:19px;border-left:none;border-right:1px solid #000}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{padding-left:18px;font-weight:700;color:#000;background-color:transparent;border-left:2px solid #000}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{padding-right:18px;border-left:none;border-right:2px solid #000}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{padding-top:1px;padding-bottom:1px;padding-left:30px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:40px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{padding-left:28px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{padding-left:38px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,Hiragino Kaku Gothic Pro,\\30D2\30E9\30AE\30CE\89D2\30B4 Pro W3,Osaka,Meiryo,\\30E1\30A4\30EA\30AA,MS Gothic,"\FF2D\FF33   \30B4\30B7\30C3\30AF",sans-serif}.ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,"\FF2D\FF33   \FF30\30B4\30B7\30C3\30AF",sans-serif}.markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,PingFang TC,Microsoft JhengHei,\\5FAE\8EDF\6B63\9ED1,sans-serif}.ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,\\5FAE\8EDF\6B63\9ED1UI,sans-serif}.markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,PingFang SC,Microsoft YaHei,\\5FAE\8F6F\96C5\9ED1,sans-serif}.ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,\\5FAE\8F6F\96C5\9ED1UI,sans-serif}.ui-affix-toc{position:fixed;top:0;max-width:15vw;max-height:70vh;overflow:auto}.back-to-top,.expand-toggle,.go-to-bottom{display:block;padding:4px 10px;margin-top:10px;margin-left:10px;font-size:12px;font-weight:500;color:#999}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{width:20px;height:20px;display:block;border-radius:3px;margin-top:2px;margin-bottom:2px;margin-right:5px;background-position:50%;background-repeat:no-repeat;background-size:contain}.ui-user-icon.small{width:18px;height:18px;display:inline-block;vertical-align:middle;margin:0 0 .2em}small span{line-height:22px}small .dropdown{display:inline-block}small .dropdown a:focus,small .dropdown a:hover{text-decoration:none}.unselectable{-moz-user-select:none;-webkit-user-select:none;-o-user-select:none;user-select:none}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{position:relative;z-index:1;color:#222}.markdown-body.slides:before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;background-color:currentColor;box-shadow:0 0 0 50vw}.markdown-body.slides section[data-markdown]{position:relative;margin-bottom:1.5em;background-color:#fff;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{position:absolute;top:50%;left:1em;right:1em;transform:translateY(-50%);max-height:100%;overflow:hidden}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{content:"";position:absolute;top:-1.5em;right:1em;height:1.5em;border:3px solid #777}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;text-shadow:0 0 1em transparent,1px 1px 1.2px rgba(0,0,0,.004);-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}.focus,:focus{outline:none!important}::-moz-focus-inner{border:0!important}body.modal-open{overflow-y:auto;padding-right:0!important}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid"><h1 id="報告主題：chapter-4-locking"><a class="anchor hidden-xs" href="#報告主題：chapter-4-locking" title="報告主題：chapter-4-locking"><span class="octicon octicon-link"></span></a>報告主題：Chapter 4. Locking</h1><h2 id="一、運作原理"><a class="anchor hidden-xs" href="#一、運作原理" title="一、運作原理"><span class="octicon octicon-link"></span></a>一、運作原理</h2><h3 id="1-前言"><a class="anchor hidden-xs" href="#1-前言" title="1-前言"><span class="octicon octicon-link"></span></a>1. 前言</h3><p>一般多處理器系統(Multiprocessors System)具有多顆CPU並且共享系統中的記憶體，但所有CPU因為是個別執行，因此可能會發生有些超過負載、有些閒置等負載不均的情形，這時可透過CPU共享系統的一些資料結構來達到負載平衡，但隨之而來卻可能發生資源被干擾、資源互搶的問題，這時就必須做<strong>並行控制(Concurrency Control)</strong>，而在xv6中即是Locking的機制。</p><h3 id="2-原理"><a class="anchor hidden-xs" href="#2-原理" title="2-原理"><span class="octicon octicon-link"></span></a>2. 原理</h3><p>假設有一條Linked List，當兩顆CPU同時對它進行insert，如下段程式</p><pre><code class="c hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="1"></span>
<span data-linenumber="2"></span>
<span data-linenumber="3"></span>
<span data-linenumber="4"></span>
<span data-linenumber="5"></span>
<span data-linenumber="6"></span>
<span data-linenumber="7"></span>
<span data-linenumber="8"></span>
<span data-linenumber="9"></span>
<span data-linenumber="10"></span>
<span data-linenumber="11"></span>
<span data-linenumber="12"></span>
<span data-linenumber="13"></span>
<span data-linenumber="14"></span>
<span data-linenumber="15"></span>
<span data-linenumber="16"></span>
<span data-linenumber="17"></span></div><div class="code"><span class="hljs-keyword">struct</span> <span class="hljs-built_in">list</span> {
  <span class="hljs-keyword">int</span> data;
  <span class="hljs-keyword">struct</span> <span class="hljs-built_in">list</span> *next;
};

<span class="hljs-keyword">struct</span> <span class="hljs-built_in">list</span> *<span class="hljs-built_in">list</span> = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">insert</span><span class="hljs-params">(<span class="hljs-keyword">int</span> data)</span>
</span>{
  <span class="hljs-keyword">struct</span> <span class="hljs-built_in">list</span> *l;

  l = <span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span> *l);
  l-&gt;data = data;
  l-&gt;next = <span class="hljs-built_in">list</span>;
  <span class="hljs-built_in">list</span> = l;
}
</div></div></code></pre><p>當兩者執行完15行，並分別進入16行，後進入者會覆寫掉前者，此時即發生<strong>競爭關係(Race Condition)</strong>，後果不是掉資料便是讀到不完整的資料，而這就是需要有Locking機制的原因。Locks會建立<strong>互斥鎖(Mutual Exclusion)</strong>，以確保同一時間內只有一顆CPU能存取資源，如下段程式</p><pre><code class="c hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="6"></span>
<span data-linenumber="7"></span>
<span data-linenumber="8"></span>
<span data-linenumber="9"></span>
<span data-linenumber="10"></span>
<span data-linenumber="11"></span>
<span data-linenumber="12"></span>
<span data-linenumber="13"></span>
<span data-linenumber="14"></span>
<span data-linenumber="15"></span>
<span data-linenumber="16"></span>
<span data-linenumber="17"></span>
<span data-linenumber="18"></span>
<span data-linenumber="19"></span>
<span data-linenumber="20"></span></div><div class="code"><span class="hljs-keyword">struct</span> <span class="hljs-built_in">list</span> *<span class="hljs-built_in">list</span> = <span class="hljs-number">0</span>;
<span class="hljs-keyword">struct</span> lock listlock;

<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">insert</span><span class="hljs-params">(<span class="hljs-keyword">int</span> data)</span>
</span>{
  <span class="hljs-keyword">struct</span> <span class="hljs-built_in">list</span> *l;

  acquire(&amp;listlock);
  l = <span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span> *l);
  l-&gt;data = data;
  l-&gt;next = <span class="hljs-built_in">list</span>;
  <span class="hljs-built_in">list</span> = l;
  release(&amp;listlock);
}
</div></div></code></pre><p>分別於14行、19行插入acquire及release function，兩者所包覆的區段稱為<strong>臨界區段(Critical Section)</strong>，代表該區段內資料結構的操作不會受到干擾，其他CPU若要存取則必須等待，等到資源被釋放後才能存取，此即為Locks的概念。</p><p>我們也可以將Locks視為序列化(Serializing)臨界區段的過程，因此在同一時間內僅能做單一存取；又或者可以將臨界區段視為符合交易的不可分割(Atomicity)單元，該區段內的程式必須要全部正確執行完畢，否則整個不可分割的程式單元全都不能執行。</p><h2 id="二、程式流程與方法關聯"><a class="anchor hidden-xs" href="#二、程式流程與方法關聯" title="二、程式流程與方法關聯"><span class="octicon octicon-link"></span></a>二、程式流程與方法關聯</h2><h3 id="1-spinlockc"><a class="anchor hidden-xs" href="#1-spinlockc" title="1-spinlockc"><span class="octicon octicon-link"></span></a>1. spinlock.c</h3><pre class="graphviz"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: graphnam Pages: 1 -->
<svg width="442pt" height="418pt" viewBox="0.00 0.00 442.26 417.77" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 413.7735)">
<title>graphnam</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-413.7735 438.2604,-413.7735 438.2604,4 -4,4"></polygon>
<!-- release -->
<g id="node1" class="node">
<title>release</title>
<ellipse fill="none" stroke="#000000" cx="40.5433" cy="-299" rx="37.6755" ry="18"></ellipse>
<text text-anchor="middle" x="40.5433" y="-294.8" font-family="Times,serif" font-size="14.00" fill="#000000">release</text>
</g>
<!-- popcli -->
<g id="node2" class="node">
<title>popcli</title>
<ellipse fill="none" stroke="#000000" cx="206.9643" cy="-326" rx="35.3528" ry="18"></ellipse>
<text text-anchor="middle" x="206.9643" y="-321.8" font-family="Times,serif" font-size="14.00" fill="#000000">popcli</text>
</g>
<!-- release&#45;&gt;popcli -->
<g id="edge1" class="edge">
<title>release-&gt;popcli</title>
<path fill="none" stroke="#000000" d="M76.6542,-304.8586C102.0845,-308.9844 136.2661,-314.53 163.2405,-318.9063"></path>
<polygon fill="#000000" stroke="#000000" points="162.7611,-322.3742 173.1926,-320.5209 163.8822,-315.4645 162.7611,-322.3742"></polygon>
</g>
<!-- panic -->
<g id="node6" class="node">
<title>panic</title>
<ellipse fill="none" stroke="#000000" cx="383.5512" cy="-376" rx="31.9012" ry="18"></ellipse>
<text text-anchor="middle" x="383.5512" y="-371.8" font-family="Times,serif" font-size="14.00" fill="#000000">panic</text>
</g>
<!-- release&#45;&gt;panic -->
<g id="edge8" class="edge">
<title>release-&gt;panic</title>
<path fill="none" stroke="#000000" d="M65.0615,-312.7966C70.7062,-316.6324 76.4167,-321.1048 81.0866,-326 102.5527,-348.5015 90.0248,-370.6779 117.0866,-386 189.7504,-427.1415 292.3034,-405.3428 346.5526,-388.8733"></path>
<polygon fill="#000000" stroke="#000000" points="347.9275,-392.1101 356.4187,-385.7737 345.8294,-385.4319 347.9275,-392.1101"></polygon>
</g>
<!-- __sync_synchronize -->
<g id="node7" class="node">
<title>__sync_synchronize</title>
<ellipse fill="none" stroke="#000000" cx="206.9643" cy="-272" rx="89.7556" ry="18"></ellipse>
<text text-anchor="middle" x="206.9643" y="-267.8" font-family="Times,serif" font-size="14.00" fill="#000000">__sync_synchronize</text>
</g>
<!-- release&#45;&gt;__sync_synchronize -->
<g id="edge6" class="edge">
<title>release-&gt;__sync_synchronize</title>
<path fill="none" stroke="#000000" d="M76.6542,-293.1414C91.4381,-290.7429 109.1797,-287.8645 126.7435,-285.015"></path>
<polygon fill="#000000" stroke="#000000" points="127.7301,-288.4007 137.0405,-283.3444 126.6091,-281.4911 127.7301,-288.4007"></polygon>
</g>
<!-- holding -->
<g id="node8" class="node">
<title>holding</title>
<ellipse fill="none" stroke="#000000" cx="206.9643" cy="-218" rx="40.5925" ry="18"></ellipse>
<text text-anchor="middle" x="206.9643" y="-213.8" font-family="Times,serif" font-size="14.00" fill="#000000">holding</text>
</g>
<!-- release&#45;&gt;holding -->
<g id="edge7" class="edge">
<title>release-&gt;holding</title>
<path fill="none" stroke="#000000" d="M59.2774,-283.1696C74.1445,-271.2761 95.885,-255.3231 117.0866,-245 130.7738,-238.3357 146.443,-232.9393 160.8239,-228.7731"></path>
<polygon fill="#000000" stroke="#000000" points="161.8303,-232.1262 170.5339,-226.0849 159.9625,-225.38 161.8303,-232.1262"></polygon>
</g>
<!-- sti -->
<g id="node3" class="node">
<title>sti</title>
<ellipse fill="none" stroke="#000000" cx="383.5512" cy="-322" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="383.5512" y="-317.8" font-family="Times,serif" font-size="14.00" fill="#000000">sti</text>
</g>
<!-- popcli&#45;&gt;sti -->
<g id="edge2" class="edge">
<title>popcli-&gt;sti</title>
<path fill="none" stroke="#000000" d="M242.2749,-325.2002C272.3463,-324.519 315.4295,-323.5431 346.0986,-322.8484"></path>
<polygon fill="#000000" stroke="#000000" points="346.4691,-326.341 356.3872,-322.6153 346.3105,-319.3428 346.4691,-326.341"></polygon>
</g>
<!-- mycpu -->
<g id="node4" class="node">
<title>mycpu</title>
<ellipse fill="none" stroke="#000000" cx="383.5512" cy="-192" rx="37.1424" ry="18"></ellipse>
<text text-anchor="middle" x="383.5512" y="-187.8" font-family="Times,serif" font-size="14.00" fill="#000000">mycpu</text>
</g>
<!-- popcli&#45;&gt;mycpu -->
<g id="edge3" class="edge">
<title>popcli-&gt;mycpu</title>
<path fill="none" stroke="#000000" d="M241.4632,-321.9799C259.5342,-318.4095 281.1128,-311.6786 296.8421,-299 322.5533,-278.2755 311.7595,-259.4183 332.8421,-234 339.0589,-226.5047 346.7533,-219.347 354.2536,-213.1322"></path>
<polygon fill="#000000" stroke="#000000" points="356.5861,-215.7492 362.2369,-206.7871 352.2306,-210.2692 356.5861,-215.7492"></polygon>
</g>
<!-- readeflags -->
<g id="node5" class="node">
<title>readeflags</title>
<ellipse fill="none" stroke="#000000" cx="383.5512" cy="-261" rx="50.9192" ry="18"></ellipse>
<text text-anchor="middle" x="383.5512" y="-256.8" font-family="Times,serif" font-size="14.00" fill="#000000">readeflags</text>
</g>
<!-- popcli&#45;&gt;readeflags -->
<g id="edge4" class="edge">
<title>popcli-&gt;readeflags</title>
<path fill="none" stroke="#000000" d="M238.4674,-317.548C255.8515,-312.632 277.728,-306.0299 296.8421,-299 312.4063,-293.2757 329.1713,-286.1606 343.7727,-279.6404"></path>
<polygon fill="#000000" stroke="#000000" points="345.3491,-282.7689 353.0212,-275.4622 342.467,-276.3897 345.3491,-282.7689"></polygon>
</g>
<!-- popcli&#45;&gt;panic -->
<g id="edge5" class="edge">
<title>popcli-&gt;panic</title>
<path fill="none" stroke="#000000" d="M238.128,-334.8239C267.8795,-343.2479 312.7973,-355.9662 344.8328,-365.037"></path>
<polygon fill="#000000" stroke="#000000" points="344.1704,-368.487 354.7457,-367.8438 346.0775,-361.7518 344.1704,-368.487"></polygon>
</g>
<!-- holding&#45;&gt;mycpu -->
<g id="edge14" class="edge">
<title>holding-&gt;mycpu</title>
<path fill="none" stroke="#000000" d="M245.7171,-212.2942C272.7531,-208.3135 308.9519,-202.9837 337.4686,-198.785"></path>
<polygon fill="#000000" stroke="#000000" points="338.2124,-202.2133 347.5959,-197.2939 337.1927,-195.288 338.2124,-202.2133"></polygon>
</g>
<!-- acquire -->
<g id="node9" class="node">
<title>acquire</title>
<ellipse fill="none" stroke="#000000" cx="40.5433" cy="-172" rx="39.4042" ry="18"></ellipse>
<text text-anchor="middle" x="40.5433" y="-167.8" font-family="Times,serif" font-size="14.00" fill="#000000">acquire</text>
</g>
<!-- acquire&#45;&gt;mycpu -->
<g id="edge19" class="edge">
<title>acquire-&gt;mycpu</title>
<path fill="none" stroke="#000000" d="M79.8907,-174.2943C143.4108,-177.998 268.3002,-185.28 336.453,-189.2538"></path>
<polygon fill="#000000" stroke="#000000" points="336.2975,-192.7506 346.4843,-189.8387 336.705,-185.7625 336.2975,-192.7506"></polygon>
</g>
<!-- acquire&#45;&gt;panic -->
<g id="edge17" class="edge">
<title>acquire-&gt;panic</title>
<path fill="none" stroke="#000000" d="M47.7557,-189.7212C66.135,-234.7898 113.5331,-350.4177 117.0866,-353 151.8506,-378.2622 275.6466,-379.0174 341.5535,-377.4979"></path>
<polygon fill="#000000" stroke="#000000" points="341.7054,-380.9952 351.6116,-377.2379 341.5245,-373.9976 341.7054,-380.9952"></polygon>
</g>
<!-- acquire&#45;&gt;__sync_synchronize -->
<g id="edge18" class="edge">
<title>acquire-&gt;__sync_synchronize</title>
<path fill="none" stroke="#000000" d="M54.3125,-189.1771C68.4326,-205.7158 91.8471,-230.321 117.0866,-245 123.4772,-248.7167 130.426,-251.9641 137.5343,-254.7917"></path>
<polygon fill="#000000" stroke="#000000" points="136.6957,-258.2129 147.289,-258.3922 139.1196,-251.646 136.6957,-258.2129"></polygon>
</g>
<!-- acquire&#45;&gt;holding -->
<g id="edge13" class="edge">
<title>acquire-&gt;holding</title>
<path fill="none" stroke="#000000" d="M74.6227,-181.4198C100.0309,-188.4428 134.9609,-198.0977 162.5554,-205.725"></path>
<polygon fill="#000000" stroke="#000000" points="161.7876,-209.144 172.3586,-208.4347 163.6525,-202.397 161.7876,-209.144"></polygon>
</g>
<!-- pushcli -->
<g id="node10" class="node">
<title>pushcli</title>
<ellipse fill="none" stroke="#000000" cx="206.9643" cy="-126" rx="38.8632" ry="18"></ellipse>
<text text-anchor="middle" x="206.9643" y="-121.8" font-family="Times,serif" font-size="14.00" fill="#000000">pushcli</text>
</g>
<!-- acquire&#45;&gt;pushcli -->
<g id="edge9" class="edge">
<title>acquire-&gt;pushcli</title>
<path fill="none" stroke="#000000" d="M74.6227,-162.5802C100.3697,-155.4636 135.894,-145.6444 163.6552,-137.971"></path>
<polygon fill="#000000" stroke="#000000" points="164.7932,-141.2877 173.4993,-135.25 162.9282,-134.5407 164.7932,-141.2877"></polygon>
</g>
<!-- getcallerpcs -->
<g id="node12" class="node">
<title>getcallerpcs</title>
<ellipse fill="none" stroke="#000000" cx="206.9643" cy="-72" rx="57.2972" ry="18"></ellipse>
<text text-anchor="middle" x="206.9643" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">getcallerpcs</text>
</g>
<!-- acquire&#45;&gt;getcallerpcs -->
<g id="edge15" class="edge">
<title>acquire-&gt;getcallerpcs</title>
<path fill="none" stroke="#000000" d="M54.3125,-154.8229C68.4326,-138.2842 91.8471,-113.679 117.0866,-99 126.9993,-93.2349 138.255,-88.599 149.366,-84.9071"></path>
<polygon fill="#000000" stroke="#000000" points="150.5417,-88.207 159.0555,-81.9011 148.4675,-81.5213 150.5417,-88.207"></polygon>
</g>
<!-- xchg -->
<g id="node13" class="node">
<title>xchg</title>
<ellipse fill="none" stroke="#000000" cx="206.9643" cy="-18" rx="29.6185" ry="18"></ellipse>
<text text-anchor="middle" x="206.9643" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">xchg</text>
</g>
<!-- acquire&#45;&gt;xchg -->
<g id="edge16" class="edge">
<title>acquire-&gt;xchg</title>
<path fill="none" stroke="#000000" d="M46.5877,-153.956C56.7493,-126.3727 79.8727,-73.8886 117.0866,-45 131.4748,-33.8307 150.437,-27.2675 167.2342,-23.4176"></path>
<polygon fill="#000000" stroke="#000000" points="168.2538,-26.7818 177.3527,-21.3542 166.855,-19.923 168.2538,-26.7818"></polygon>
</g>
<!-- pushcli&#45;&gt;mycpu -->
<g id="edge12" class="edge">
<title>pushcli-&gt;mycpu</title>
<path fill="none" stroke="#000000" d="M238.2487,-136.8653C255.5666,-142.9484 277.4497,-150.7478 296.8421,-158 312.7445,-163.947 330.1889,-170.7354 345.2351,-176.6745"></path>
<polygon fill="#000000" stroke="#000000" points="344.1499,-180.0091 354.736,-180.4373 346.7274,-173.5009 344.1499,-180.0091"></polygon>
</g>
<!-- pushcli&#45;&gt;readeflags -->
<g id="edge11" class="edge">
<title>pushcli-&gt;readeflags</title>
<path fill="none" stroke="#000000" d="M228.6281,-141.1811C246.9807,-154.1572 273.8935,-173.4582 296.8421,-191 316.7879,-206.2466 338.7922,-224.0224 355.6432,-237.8458"></path>
<polygon fill="#000000" stroke="#000000" points="353.5241,-240.6346 363.4699,-244.2859 357.9718,-235.2293 353.5241,-240.6346"></polygon>
</g>
<!-- cli -->
<g id="node11" class="node">
<title>cli</title>
<ellipse fill="none" stroke="#000000" cx="383.5512" cy="-126" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="383.5512" y="-121.8" font-family="Times,serif" font-size="14.00" fill="#000000">cli</text>
</g>
<!-- pushcli&#45;&gt;cli -->
<g id="edge10" class="edge">
<title>pushcli-&gt;cli</title>
<path fill="none" stroke="#000000" d="M246.1547,-126C276.0183,-126 316.8708,-126 346.2557,-126"></path>
<polygon fill="#000000" stroke="#000000" points="346.5213,-129.5001 356.5212,-126 346.5212,-122.5001 346.5213,-129.5001"></polygon>
</g>
<!-- initlock -->
<g id="node14" class="node">
<title>initlock</title>
<ellipse fill="none" stroke="#000000" cx="40.5433" cy="-353" rx="40.5867" ry="18"></ellipse>
<text text-anchor="middle" x="40.5433" y="-348.8" font-family="Times,serif" font-size="14.00" fill="#000000">initlock</text>
</g>
</g>
</svg>
</pre><h4 id="1-1-initlock"><a class="anchor hidden-xs" href="#1-1-initlock" title="1-1-initlock"><span class="octicon octicon-link"></span></a>1-1. initlock</h4><pre class="flow-chart"><svg height="417" version="1.1" width="163.046875" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.5px; top: -0.96875px;" viewBox="0 0 163.046875 417" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><marker id="raphael-marker-endblock33-objv2qus" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objn75wa" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objb5p49" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj9d4xy" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="65.375" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,49.8359,4)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="stt" class="flowchartt" transform="matrix(1,0,0,1,49.8359,4)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Start</tspan></text><rect x="0" y="0" width="157.046875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op1" transform="matrix(1,0,0,1,4,97)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op1t" class="flowchartt" transform="matrix(1,0,0,1,4,97)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;name = name</tspan></text><rect x="0" y="0" width="147.90625" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op2" transform="matrix(1,0,0,1,8.5703,190)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op2t" class="flowchartt" transform="matrix(1,0,0,1,8.5703,190)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;locked = 0</tspan></text><rect x="0" y="0" width="120.453125" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op3" transform="matrix(1,0,0,1,22.2969,283)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op3t" class="flowchartt" transform="matrix(1,0,0,1,22.2969,283)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;cpu = 0</tspan></text><rect x="0" y="0" width="47.078125" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="e" transform="matrix(1,0,0,1,58.9844,376)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="et" class="flowchartt" transform="matrix(1,0,0,1,58.9844,376)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">End</tspan></text><path fill="none" stroke="#000000" d="M82.5234375,43C82.5234375,43,82.5234375,82.65409994125366,82.5234375,94.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objv2qus)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M82.5234375,136C82.5234375,136,82.5234375,175.65409994125366,82.5234375,187.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objn75wa)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M82.5234375,229C82.5234375,229,82.5234375,268.65409994125366,82.5234375,280.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objb5p49)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M82.5234375,322C82.5234375,322,82.5234375,361.65409994125366,82.5234375,373.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj9d4xy)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path></svg></pre><h4 id="1-2-acquire"><a class="anchor hidden-xs" href="#1-2-acquire" title="1-2-acquire"><span class="octicon octicon-link"></span></a>1-2. acquire</h4><pre class="flow-chart"><svg height="1382.0390625" version="1.1" width="948.109375" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.5px; top: -0.96875px;" viewBox="0 0 948.109375 1382.0390625" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><marker id="raphael-marker-endblock33-obj9phoz" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objc6092" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj5hzqm" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj5sy6z" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj71htz" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objsdq76" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objv3t78" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj1na6s" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj044cn" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objrnhcx" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj9rago" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj2fyqt" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objgtots" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="65.375" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,129.2891,54.0039)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="stt" class="flowchartt" transform="matrix(1,0,0,1,129.2891,54.0039)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Start</tspan></text><rect x="0" y="0" width="103.671875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub1" transform="matrix(1,0,0,1,110.1406,197.0078)"></rect><rect x="10" y="0" width="83.671875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub1i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,110.1406,197.0078)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub1t" class="flowchartt" transform="matrix(1,0,0,1,110.1406,197.0078)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">pushcli</tspan></text><path fill="none" stroke="#000000" d="M10,19.5L0,39L213.640625,39L233.640625,0L20,0L10,19.5" stroke-width="2" font-family="'Andale Mono', monospace" id="io1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,45.1563,340.0117)"></path><text x="30" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="io1t" class="flowchartt" transform="matrix(1,0,0,1,45.1563,340.0117)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">input lk to holding</tspan></text><rect x="0" y="0" width="103.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub2" transform="matrix(1,0,0,1,110.0391,483.0156)"></rect><rect x="10" y="0" width="83.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub2i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,110.0391,483.0156)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub2t" class="flowchartt" transform="matrix(1,0,0,1,110.0391,483.0156)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">holding</tspan></text><path fill="none" stroke="#000000" d="M69.50390625,34.751953125L0,69.50390625L139.0078125,139.0078125L278.015625,69.50390625L139.0078125,0L0,69.50390625" stroke-width="2" font-family="'Andale Mono', monospace" id="cond1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,22.9688,576.0156)"></path><text x="74.50390625" y="69.50390625" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="cond1t" class="flowchartt" transform="matrix(1,0,0,1,22.9688,576.0156)" stroke-width="1"><tspan dy="5.50390625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">if result is true</tspan></text><rect x="0" y="0" width="85.375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub3" transform="matrix(1,0,0,1,119.2891,819.0273)"></rect><rect x="10" y="0" width="65.375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub3i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,119.2891,819.0273)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub3t" class="flowchartt" transform="matrix(1,0,0,1,119.2891,819.0273)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">panic</tspan></text><path fill="none" stroke="#000000" d="M10,19.5L0,39L295.953125,39L315.953125,0L20,0L10,19.5" stroke-width="2" font-family="'Andale Mono', monospace" id="io2" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,354.9844,626.0195)"></path><text x="30" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="io2t" class="flowchartt" transform="matrix(1,0,0,1,354.9844,626.0195)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">input &amp;lk−&gt;locked, 1 to xchg</tspan></text><rect x="0" y="0" width="76.4375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub4" transform="matrix(1,0,0,1,474.7422,769.0234)"></rect><rect x="10" y="0" width="56.4375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub4i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,474.7422,769.0234)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub4t" class="flowchartt" transform="matrix(1,0,0,1,474.7422,769.0234)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">xchg</tspan></text><path fill="none" stroke="#000000" d="M59.21484375,29.607421875L0,59.21484375L118.4296875,118.4296875L236.859375,59.21484375L118.4296875,0L0,59.21484375" stroke-width="2" font-family="'Andale Mono', monospace" id="cond2" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,394.5313,872.3125)"></path><text x="64.21484375" y="59.21484375" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="cond2t" class="flowchartt" transform="matrix(1,0,0,1,394.5313,872.3125)" stroke-width="1"><tspan dy="5.51171875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">if result != 0</tspan></text><rect x="0" y="0" width="205.484375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub5" transform="matrix(1,0,0,1,740.625,912.0273)"></rect><rect x="10" y="0" width="185.484375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub5i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,740.625,912.0273)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub5t" class="flowchartt" transform="matrix(1,0,0,1,740.625,912.0273)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">__sync_synchronize</tspan></text><rect x="0" y="0" width="156.84375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op1" transform="matrix(1,0,0,1,764.9453,1055.0313)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op1t" class="flowchartt" transform="matrix(1,0,0,1,764.9453,1055.0313)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;cpu = mycpu</tspan></text><rect x="0" y="0" width="149.40625" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub6" transform="matrix(1,0,0,1,768.6641,1198.0352)"></rect><rect x="10" y="0" width="129.40625" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub6i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,768.6641,1198.0352)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub6t" class="flowchartt" transform="matrix(1,0,0,1,768.6641,1198.0352)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">getcallerpcs</tspan></text><rect x="0" y="0" width="47.078125" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="e" transform="matrix(1,0,0,1,819.8281,1341.0391)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="et" class="flowchartt" transform="matrix(1,0,0,1,819.8281,1341.0391)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">End</tspan></text><path fill="none" stroke="#000000" d="M161.9765625,93.00390625C161.9765625,93.00390625,161.9765625,176.95481324195862,161.9765625,194.0073412247002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj9phoz)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M161.9765625,236.0078125C161.9765625,236.0078125,161.9765625,319.9587194919586,161.9765625,337.0112474747002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objc6092)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M161.9765625,379.01171875C161.9765625,379.01171875,161.9765625,462.9626257419586,161.9765625,480.0151537247002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj5hzqm)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M161.9765625,522.015625C161.9765625,522.015625,161.9765625,561.6697249412537,161.9765625,573.0160640846007" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj5sy6z)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M161.9765625,715.0234375C161.9765625,715.0234375,161.9765625,798.9743444919586,161.9765625,816.0268724747002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj71htz)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="166.9765625" y="725.0234375" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.5078125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">yes</tspan></text><path fill="none" stroke="#000000" d="M300.984375,645.51953125C300.984375,645.51953125,349.330322265625,645.51953125,361.9833631515503,645.51953125" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objsdq76)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="305.984375" y="635.51953125" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.50390625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">no</tspan></text><path fill="none" stroke="#000000" d="M512.9609375,665.01953125C512.9609375,665.01953125,512.9609375,748.9704382419586,512.9609375,766.0229662247002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objv3t78)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M512.9609375,808.0234375C512.9609375,808.0234375,512.9609375,856.642326110974,512.9609375,869.3193214812181" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj1na6s)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M512.9609375,990.7421875C512.9609375,990.7421875,512.9609375,1015.7421875,512.9609375,1015.7421875C512.9609375,1015.7421875,656.390625,1015.7421875,656.390625,1015.7421875C656.390625,1015.7421875,656.390625,601.01953125,656.390625,601.01953125C656.390625,601.01953125,512.9609375,601.01953125,512.9609375,601.01953125C512.9609375,601.01953125,512.9609375,616.3929758071899,512.9609375,623.0287790242583" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj044cn)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="517.9609375" y="1000.7421875" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.5078125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">yes</tspan></text><path fill="none" stroke="#000000" d="M631.390625,931.52734375C631.390625,931.52734375,652.390625,931.52734375,652.390625,931.52734375C652.390625,931.52734375,656.390625,923.52734375,660.390625,931.52734375C660.390625,931.52734375,723.0603399127722,931.52734375,737.6261525585141,931.52734375" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objrnhcx)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="636.390625" y="921.52734375" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.51171875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">no</tspan></text><path fill="none" stroke="#000000" d="M843.3671875,951.02734375C843.3671875,951.02734375,843.3671875,1034.9782507419586,843.3671875,1052.0307787247002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj9rago)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M843.3671875,1094.03125C843.3671875,1094.03125,843.3671875,1177.9821569919586,843.3671875,1195.0346849747002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj2fyqt)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M843.3671875,1237.03515625C843.3671875,1237.03515625,843.3671875,1320.9860632419586,843.3671875,1338.0385912247002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objgtots)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path></svg></pre><h4 id="1-3-release"><a class="anchor hidden-xs" href="#1-3-release" title="1-3-release"><span class="octicon octicon-link"></span></a>1-3. release</h4><pre class="flow-chart"><svg height="1123.453125" version="1.1" width="600.33203125" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.5px; top: -0.96875px;" viewBox="0 0 600.33203125 1123.453125" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><marker id="raphael-marker-endblock33-objmytgr" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objiw2ht" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objybr2p" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj4jrp9" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objl6gy3" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj3yoed" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj3brmy" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj4mkb0" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objyx6of" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="65.375" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,117.1758,57.4316)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="stt" class="flowchartt" transform="matrix(1,0,0,1,117.1758,57.4316)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Start</tspan></text><path fill="none" stroke="#000000" d="M10,19.5L0,39L213.640625,39L233.640625,0L20,0L10,19.5" stroke-width="2" font-family="'Andale Mono', monospace" id="io1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,33.043,203.8633)"></path><text x="30" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="io1t" class="flowchartt" transform="matrix(1,0,0,1,33.043,203.8633)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">input lk to holding</tspan></text><rect x="0" y="0" width="103.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub1" transform="matrix(1,0,0,1,97.9258,350.2949)"></rect><rect x="10" y="0" width="83.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub1i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,97.9258,350.2949)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub1t" class="flowchartt" transform="matrix(1,0,0,1,97.9258,350.2949)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">holding</tspan></text><path fill="none" stroke="#000000" d="M72.931640625,36.4658203125L0,72.931640625L145.86328125,145.86328125L291.7265625,72.931640625L145.86328125,0L0,72.931640625" stroke-width="2" font-family="'Andale Mono', monospace" id="cond1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,4,443.2949)"></path><text x="77.931640625" y="72.931640625" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="cond1t" class="flowchartt" transform="matrix(1,0,0,1,4,443.2949)" stroke-width="1"><tspan dy="5.509765625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">if result is false</tspan></text><rect x="0" y="0" width="85.375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub2" transform="matrix(1,0,0,1,107.1758,696.5898)"></rect><rect x="10" y="0" width="65.375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub2i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,107.1758,696.5898)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub2t" class="flowchartt" transform="matrix(1,0,0,1,107.1758,696.5898)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">panic</tspan></text><rect x="0" y="0" width="147.90625" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op1" transform="matrix(1,0,0,1,421.6367,496.7266)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op1t" class="flowchartt" transform="matrix(1,0,0,1,421.6367,496.7266)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;pcs[0] = 0</tspan></text><rect x="0" y="0" width="120.453125" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op2" transform="matrix(1,0,0,1,435.3633,643.1582)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op2t" class="flowchartt" transform="matrix(1,0,0,1,435.3633,643.1582)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;cpu = 0</tspan></text><rect x="0" y="0" width="205.484375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub3" transform="matrix(1,0,0,1,392.8477,789.5898)"></rect><rect x="10" y="0" width="185.484375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub3i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,392.8477,789.5898)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub3t" class="flowchartt" transform="matrix(1,0,0,1,392.8477,789.5898)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">__sync_synchronize</tspan></text><rect x="0" y="0" width="94.53125" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub4" transform="matrix(1,0,0,1,448.3242,936.0215)"></rect><rect x="10" y="0" width="74.53125" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub4i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,448.3242,936.0215)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub4t" class="flowchartt" transform="matrix(1,0,0,1,448.3242,936.0215)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">popcli</tspan></text><rect x="0" y="0" width="47.078125" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="e" transform="matrix(1,0,0,1,472.0508,1082.4531)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="et" class="flowchartt" transform="matrix(1,0,0,1,472.0508,1082.4531)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">End</tspan></text><path fill="none" stroke="#000000" d="M149.86328125,96.431640625C149.86328125,96.431640625,149.86328125,183.47959853860084,149.86328125,200.863687789901" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objmytgr)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M149.86328125,242.86328125C149.86328125,242.86328125,149.86328125,329.91123916360084,149.86328125,347.295328414901" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objiw2ht)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M149.86328125,389.294921875C149.86328125,389.294921875,149.86328125,428.94902181625366,149.86328125,440.29536095960066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objybr2p)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M149.86328125,589.158203125C149.86328125,589.158203125,149.86328125,676.2061610386008,149.86328125,693.590250289901" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj4jrp9)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="154.86328125" y="599.158203125" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.501953125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">yes</tspan></text><path fill="none" stroke="#000000" d="M295.7265625,516.2265625C295.7265625,516.2265625,399.5255754350219,516.2265625,418.63310857784575,516.2265625" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objl6gy3)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="300.7265625" y="506.2265625" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.5078125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">no</tspan></text><path fill="none" stroke="#000000" d="M495.58984375,535.7265625C495.58984375,535.7265625,495.58984375,622.7745204136008,495.58984375,640.1586096649011" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj3yoed)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M495.58984375,682.158203125C495.58984375,682.158203125,495.58984375,769.2061610386008,495.58984375,786.590250289901" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj3brmy)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M495.58984375,828.58984375C495.58984375,828.58984375,495.58984375,915.6378016636008,495.58984375,933.021890914901" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj4mkb0)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M495.58984375,975.021484375C495.58984375,975.021484375,495.58984375,1062.0694422886008,495.58984375,1079.453531539901" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objyx6of)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path></svg></pre><h4 id="1-4-pushcli"><a class="anchor hidden-xs" href="#1-4-pushcli" title="1-4-pushcli"><span class="octicon octicon-link"></span></a>1-4. pushcli</h4><pre class="flow-chart"><svg height="1318.86328125" version="1.1" width="318.34375" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.5px; top: -0.96875px;" viewBox="0 0 318.34375 1318.86328125" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><marker id="raphael-marker-endblock33-objgkih5" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj9e88j" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objt6sbr" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objdsl7o" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj34nnk" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objcg3oj" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objnjagz" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj2mo70" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj73aca" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objjdpu9" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="65.375" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,127.4844,43.7148)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="stt" class="flowchartt" transform="matrix(1,0,0,1,127.4844,43.7148)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Start</tspan></text><rect x="0" y="0" width="131.109375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub1" transform="matrix(1,0,0,1,94.6172,176.4297)"></rect><rect x="10" y="0" width="111.109375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub1i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,94.6172,176.4297)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub1t" class="flowchartt" transform="matrix(1,0,0,1,94.6172,176.4297)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">readeflags</tspan></text><path fill="none" stroke="#000000" d="M10,19.5L0,39L94.515625,39L114.515625,0L20,0L10,19.5" stroke-width="2" font-family="'Andale Mono', monospace" id="io1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,102.9141,309.1445)"></path><text x="30" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="io1t" class="flowchartt" transform="matrix(1,0,0,1,102.9141,309.1445)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">eflags</tspan></text><rect x="0" y="0" width="67.078125" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub2" transform="matrix(1,0,0,1,126.6328,441.8594)"></rect><rect x="10" y="0" width="47.078125" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub2i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,126.6328,441.8594)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub2t" class="flowchartt" transform="matrix(1,0,0,1,126.6328,441.8594)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">cli</tspan></text><rect x="0" y="0" width="184.484375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op1" transform="matrix(1,0,0,1,67.9297,574.5742)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op1t" class="flowchartt" transform="matrix(1,0,0,1,67.9297,574.5742)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">mycpu()−&gt;ncli == 0</tspan></text><path fill="none" stroke="#000000" d="M10,19.5L0,39L94.515625,39L114.515625,0L20,0L10,19.5" stroke-width="2" font-family="'Andale Mono', monospace" id="io2" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,102.9141,707.2891)"></path><text x="30" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="io2t" class="flowchartt" transform="matrix(1,0,0,1,102.9141,707.2891)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">result</tspan></text><path fill="none" stroke="#000000" d="M59.21484375,29.607421875L0,59.21484375L118.4296875,118.4296875L236.859375,59.21484375L118.4296875,0L0,59.21484375" stroke-width="2" font-family="'Andale Mono', monospace" id="cond1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,41.7422,800.2891)"></path><text x="64.21484375" y="59.21484375" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="cond1t" class="flowchartt" transform="matrix(1,0,0,1,41.7422,800.2891)" stroke-width="1"><tspan dy="5.51171875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">if result is 0</tspan></text><rect x="0" y="0" width="312.34375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op2" transform="matrix(1,0,0,1,4,1012.4336)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op2t" class="flowchartt" transform="matrix(1,0,0,1,4,1012.4336)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">mycpu()−&gt;intena = eflags &amp; FL_IF</tspan></text><rect x="0" y="0" width="184.484375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op3" transform="matrix(1,0,0,1,67.9297,1145.1484)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op3t" class="flowchartt" transform="matrix(1,0,0,1,67.9297,1145.1484)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">mycpu()−&gt;ncli += 1</tspan></text><rect x="0" y="0" width="47.078125" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="e" transform="matrix(1,0,0,1,136.6328,1277.8633)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="et" class="flowchartt" transform="matrix(1,0,0,1,136.6328,1277.8633)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">End</tspan></text><path fill="none" stroke="#000000" d="M160.171875,82.71484375C160.171875,82.71484375,160.171875,157.41790690436028,160.171875,173.43091702387403" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objgkih5)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M160.171875,215.4296875C160.171875,215.4296875,160.171875,290.1327506543603,160.171875,306.14576077387403" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj9e88j)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M160.171875,348.14453125C160.171875,348.14453125,160.171875,422.8475944043603,160.171875,438.86060452387403" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objt6sbr)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M160.171875,480.859375C160.171875,480.859375,160.171875,555.5624381543603,160.171875,571.575448273874" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objdsl7o)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M160.171875,613.57421875C160.171875,613.57421875,160.171875,688.2772819043603,160.171875,704.290292023874" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj34nnk)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M160.171875,746.2890625C160.171875,746.2890625,160.171875,785.9431624412537,160.171875,797.2895015846007" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objcg3oj)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M160.171875,918.71875C160.171875,918.71875,160.171875,993.4218131543603,160.171875,1009.4348232738741" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objnjagz)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="165.171875" y="928.71875" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">yes</tspan></text><path fill="none" stroke="#000000" d="M278.6015625,859.50390625C278.6015625,859.50390625,303.6015625,859.50390625,303.6015625,859.50390625C303.6015625,859.50390625,303.6015625,1120.1484375,303.6015625,1120.1484375C303.6015625,1120.1484375,160.171875,1120.1484375,160.171875,1120.1484375C160.171875,1120.1484375,160.171875,1135.52188205719,160.171875,1142.1576852742583" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj2mo70)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="283.6015625" y="849.50390625" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.50390625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">no</tspan></text><path fill="none" stroke="#000000" d="M160.171875,1051.43359375C160.171875,1051.43359375,160.171875,1126.1366569043603,160.171875,1142.149667023874" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj73aca)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M160.171875,1184.1484375C160.171875,1184.1484375,160.171875,1258.8515006543603,160.171875,1274.864510773874" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objjdpu9)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path></svg></pre><h4 id="1-5-popcli"><a class="anchor hidden-xs" href="#1-5-popcli" title="1-5-popcli"><span class="octicon octicon-link"></span></a>1-5. popcli</h4><pre class="flow-chart"><svg height="1432.04296875" version="1.1" width="1080.57421875" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.5px; top: -0.96875px;" viewBox="0 0 1080.57421875 1432.04296875" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><marker id="raphael-marker-endblock33-objfo8id" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objita2f" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objh6ccp" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objl6mc8" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj9qdn5" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objo0o46" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objm2wc2" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objbzsd8" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objt2bhk" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obja3wkr" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objrle7a" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objz957n" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obji4hli" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objh0sj6" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="65.375" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,150.3516,54.0039)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="stt" class="flowchartt" transform="matrix(1,0,0,1,150.3516,54.0039)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Start</tspan></text><rect x="0" y="0" width="131.109375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub1" transform="matrix(1,0,0,1,117.4844,197.0078)"></rect><rect x="10" y="0" width="111.109375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub1i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,117.4844,197.0078)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub1t" class="flowchartt" transform="matrix(1,0,0,1,117.4844,197.0078)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">readeflags</tspan></text><path fill="none" stroke="#000000" d="M10,19.5L0,39L94.515625,39L114.515625,0L20,0L10,19.5" stroke-width="2" font-family="'Andale Mono', monospace" id="io1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,125.7813,340.0117)"></path><text x="30" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="io1t" class="flowchartt" transform="matrix(1,0,0,1,125.7813,340.0117)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">eflags</tspan></text><path fill="none" stroke="#000000" d="M69.427734375,34.7138671875L0,69.427734375L138.85546875,138.85546875L277.7109375,69.427734375L138.85546875,0L0,69.427734375" stroke-width="2" font-family="'Andale Mono', monospace" id="cond1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,44.1836,433.0879)"></path><text x="74.427734375" y="69.427734375" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="cond1t" class="flowchartt" transform="matrix(1,0,0,1,44.1836,433.0879)" stroke-width="1"><tspan dy="5.505859375" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">if eflags &amp; FL_IF</tspan></text><rect x="0" y="0" width="85.375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub2" transform="matrix(1,0,0,1,140.3516,675.9473)"></rect><rect x="10" y="0" width="65.375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub2i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,140.3516,675.9473)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub2t" class="flowchartt" transform="matrix(1,0,0,1,140.3516,675.9473)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">panic</tspan></text><rect x="0" y="0" width="193.640625" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op1" transform="matrix(1,0,0,1,458.1133,483.0156)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op1t" class="flowchartt" transform="matrix(1,0,0,1,458.1133,483.0156)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">−−mycpu()−&gt;ncli &lt; 0</tspan></text><path fill="none" stroke="#000000" d="M10,19.5L0,39L94.515625,39L114.515625,0L20,0L10,19.5" stroke-width="2" font-family="'Andale Mono', monospace" id="io2" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,497.6758,626.0195)"></path><text x="30" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="io2t" class="flowchartt" transform="matrix(1,0,0,1,497.6758,626.0195)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">result</tspan></text><path fill="none" stroke="#000000" d="M55.78125,27.890625L0,55.78125L111.5625,111.5625L223.125,55.78125L111.5625,0L0,55.78125" stroke-width="2" font-family="'Andale Mono', monospace" id="cond2" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,443.3711,732.7422)"></path><text x="60.78125" y="55.78125" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="cond2t" class="flowchartt" transform="matrix(1,0,0,1,443.3711,732.7422)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">if result &lt; 0</tspan></text><rect x="0" y="0" width="358.078125" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op2" transform="matrix(1,0,0,1,720.4961,769.0234)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op2t" class="flowchartt" transform="matrix(1,0,0,1,720.4961,769.0234)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">mycpu()−&gt;ncli == 0 &amp;&amp; mycpu()−&gt;intena</tspan></text><path fill="none" stroke="#000000" d="M10,19.5L0,39L94.515625,39L114.515625,0L20,0L10,19.5" stroke-width="2" font-family="'Andale Mono', monospace" id="io3" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,842.2773,912.0273)"></path><text x="30" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="io3t" class="flowchartt" transform="matrix(1,0,0,1,842.2773,912.0273)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">result</tspan></text><path fill="none" stroke="#000000" d="M69.50390625,34.751953125L0,69.50390625L139.0078125,139.0078125L278.015625,69.50390625L139.0078125,0L0,69.50390625" stroke-width="2" font-family="'Andale Mono', monospace" id="cond3" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,760.5273,1005.0273)"></path><text x="74.50390625" y="69.50390625" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="cond3t" class="flowchartt" transform="matrix(1,0,0,1,760.5273,1005.0273)" stroke-width="1"><tspan dy="5.50390625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">if result is true</tspan></text><rect x="0" y="0" width="67.078125" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub3" transform="matrix(1,0,0,1,865.9961,1248.0391)"></rect><rect x="10" y="0" width="47.078125" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub3i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,865.9961,1248.0391)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub3t" class="flowchartt" transform="matrix(1,0,0,1,865.9961,1248.0391)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">sti</tspan></text><rect x="0" y="0" width="47.078125" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="e" transform="matrix(1,0,0,1,875.9961,1391.043)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="et" class="flowchartt" transform="matrix(1,0,0,1,875.9961,1391.043)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">End</tspan></text><path fill="none" stroke="#000000" d="M183.0390625,93.00390625C183.0390625,93.00390625,183.0390625,176.95481324195862,183.0390625,194.0073412247002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objfo8id)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M183.0390625,236.0078125C183.0390625,236.0078125,183.0390625,319.9587194919586,183.0390625,337.0112474747002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objita2f)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M183.0390625,379.01171875C183.0390625,379.01171875,183.0390625,418.7217543791048,183.0390625,430.0840985581358" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objh6ccp)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M183.0390625,571.943359375C183.0390625,571.943359375,183.0390625,655.8942663669586,183.0390625,672.9467943497002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objl6mc8)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="188.0390625" y="581.943359375" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.505859375" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">yes</tspan></text><path fill="none" stroke="#000000" d="M321.89453125,502.515625C321.89453125,502.515625,435.09953462332487,502.515625,455.1094033836489,502.515625" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj9qdn5)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="326.89453125" y="492.515625" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">no</tspan></text><path fill="none" stroke="#000000" d="M554.93359375,522.015625C554.93359375,522.015625,554.93359375,605.9665319919586,554.93359375,623.0190599747002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objo0o46)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M554.93359375,665.01953125C554.93359375,665.01953125,554.93359375,716.6384743601084,554.93359375,729.7448466341593" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objm2wc2)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M554.93359375,844.3046875C554.93359375,844.3046875,554.93359375,650.947265625,554.93359375,650.947265625C554.93359375,650.947265625,183.0390625,650.947265625,183.0390625,650.947265625C183.0390625,650.947265625,183.0390625,666.3207101821899,183.0390625,672.9565133992583" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objbzsd8)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="559.93359375" y="854.3046875" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.5078125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">yes</tspan></text><path fill="none" stroke="#000000" d="M666.49609375,788.5234375C666.49609375,788.5234375,706.1501936912537,788.5234375,717.4965328346007,788.5234375" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objt2bhk)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="671.49609375" y="778.5234375" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.5078125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">no</tspan></text><path fill="none" stroke="#000000" d="M899.53515625,808.0234375C899.53515625,808.0234375,899.53515625,891.9743444919586,899.53515625,909.0268724747002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obja3wkr)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M899.53515625,951.02734375C899.53515625,951.02734375,899.53515625,990.6814436912537,899.53515625,1002.0277828346007" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objrle7a)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M899.53515625,1144.03515625C899.53515625,1144.03515625,899.53515625,1227.9860632419586,899.53515625,1245.0385912247002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objz957n)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="904.53515625" y="1154.03515625" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.50390625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">yes</tspan></text><path fill="none" stroke="#000000" d="M1038.54296875,1074.53125C1038.54296875,1074.53125,1063.54296875,1074.53125,1063.54296875,1074.53125C1063.54296875,1074.53125,1063.54296875,1366.04296875,1063.54296875,1366.04296875C1063.54296875,1366.04296875,899.53515625,1366.04296875,899.53515625,1366.04296875C899.53515625,1366.04296875,899.53515625,1381.41641330719,899.53515625,1388.0522165242583" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obji4hli)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="1043.54296875" y="1064.53125" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">no</tspan></text><path fill="none" stroke="#000000" d="M899.53515625,1287.0390625C899.53515625,1287.0390625,899.53515625,1370.9899694919586,899.53515625,1388.0424974747002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objh0sj6)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path></svg></pre><h4 id="1-6-holding"><a class="anchor hidden-xs" href="#1-6-holding" title="1-6-holding"><span class="octicon octicon-link"></span></a>1-6. holding</h4><pre class="flow-chart"><svg height="841.96875" version="1.1" width="752.203125" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.5px; top: -0.96875px;" viewBox="0 0 752.203125 841.96875" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><marker id="raphael-marker-endblock33-objwyy17" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objllc4a" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objn9vyc" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj3nx5o" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objzwcz4" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objc4jlp" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objey1qs" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="65.375" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,137.6133,67.6504)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="stt" class="flowchartt" transform="matrix(1,0,0,1,137.6133,67.6504)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Start</tspan></text><path fill="none" stroke="#000000" d="M62.56640625,31.283203125L0,62.56640625L125.1328125,125.1328125L250.265625,62.56640625L125.1328125,0L0,62.56640625" stroke-width="2" font-family="'Andale Mono', monospace" id="cond1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,45.168,181.2344)"></path><text x="67.56640625" y="62.56640625" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="cond1t" class="flowchartt" transform="matrix(1,0,0,1,45.168,181.2344)" stroke-width="1"><tspan dy="5.50390625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">if lock−&gt;locked</tspan></text><path fill="none" stroke="#000000" d="M83.150390625,41.5751953125L0,83.150390625L166.30078125,166.30078125L332.6015625,83.150390625L166.30078125,0L0,83.150390625" stroke-width="2" font-family="'Andale Mono', monospace" id="cond2" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,4,360.3672)"></path><text x="88.150390625" y="83.150390625" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="cond2t" class="flowchartt" transform="matrix(1,0,0,1,4,360.3672)" stroke-width="1"><tspan dy="5.509765625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">if lock−&gt;cpu == mycpu</tspan></text><path fill="none" stroke="#000000" d="M10,19.5L0,39L113.015625,39L133.015625,0L20,0L10,19.5" stroke-width="2" font-family="'Andale Mono', monospace" id="io1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,103.793,644.3184)"></path><text x="30" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="io1t" class="flowchartt" transform="matrix(1,0,0,1,103.793,644.3184)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">output 1</tspan></text><rect x="0" y="0" width="47.078125" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="e" transform="matrix(1,0,0,1,146.7617,800.9688)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="et" class="flowchartt" transform="matrix(1,0,0,1,146.7617,800.9688)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">End</tspan></text><path fill="none" stroke="#000000" d="M10,19.5L0,39L113.015625,39L133.015625,0L20,0L10,19.5" stroke-width="2" font-family="'Andale Mono', monospace" id="io2" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,490.3945,424.0176)"></path><text x="30" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="io2t" class="flowchartt" transform="matrix(1,0,0,1,490.3945,424.0176)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">output 0</tspan></text><path fill="none" stroke="#000000" d="M170.30078125,106.650390625C170.30078125,106.650390625,170.30078125,164.32877690857276,170.30078125,178.2414345375205" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objwyy17)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M170.30078125,306.3671875C170.30078125,306.3671875,170.30078125,346.02128744125366,170.30078125,357.36762658460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objllc4a)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="175.30078125" y="316.3671875" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.5078125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">yes</tspan></text><path fill="none" stroke="#000000" d="M295.43359375,243.80078125C295.43359375,243.80078125,556.90234375,243.80078125,556.90234375,243.80078125C556.90234375,243.80078125,556.90234375,397.52703829843085,556.90234375,421.0213344196022" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objn9vyc)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="300.43359375" y="233.80078125" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.50390625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">no</tspan></text><path fill="none" stroke="#000000" d="M170.30078125,526.66796875C170.30078125,526.66796875,170.30078125,622.9808349856175,170.30078125,641.3216640050955" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj3nx5o)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="175.30078125" y="536.66796875" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.51171875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">yes</tspan></text><path fill="none" stroke="#000000" d="M336.6015625,443.517578125C336.6015625,443.517578125,475.1388241488021,443.517578125,497.3940776070325,443.517578125" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objzwcz4)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="341.6015625" y="433.517578125" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.501953125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">no</tspan></text><path fill="none" stroke="#000000" d="M170.30078125,683.318359375C170.30078125,683.318359375,170.30078125,779.6312256106175,170.30078125,797.9720546300955" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objc4jlp)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M556.90234375,463.017578125C556.90234375,463.017578125,556.90234375,775.96875,556.90234375,775.96875C556.90234375,775.96875,170.30078125,775.96875,170.30078125,775.96875C170.30078125,775.96875,170.30078125,791.3421945571899,170.30078125,797.9779977742583" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objey1qs)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path></svg></pre><h3 id="2-sleeplockc"><a class="anchor hidden-xs" href="#2-sleeplockc" title="2-sleeplockc"><span class="octicon octicon-link"></span></a>2. sleeplock.c</h3><pre class="graphviz"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: graphnam Pages: 1 -->
<svg width="247pt" height="260pt" viewBox="0.00 0.00 246.91 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 256)">
<title>graphnam</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-256 242.9081,-256 242.9081,4 -4,4"></polygon>
<!-- releasesleep -->
<g id="node1" class="node">
<title>releasesleep</title>
<ellipse fill="none" stroke="#000000" cx="60.3874" cy="-180" rx="57.8577" ry="18"></ellipse>
<text text-anchor="middle" x="60.3874" y="-175.8" font-family="Times,serif" font-size="14.00" fill="#000000">releasesleep</text>
</g>
<!-- acquire -->
<g id="node2" class="node">
<title>acquire</title>
<ellipse fill="none" stroke="#000000" cx="197.8414" cy="-126" rx="39.4042" ry="18"></ellipse>
<text text-anchor="middle" x="197.8414" y="-121.8" font-family="Times,serif" font-size="14.00" fill="#000000">acquire</text>
</g>
<!-- releasesleep&#45;&gt;acquire -->
<g id="edge1" class="edge">
<title>releasesleep-&gt;acquire</title>
<path fill="none" stroke="#000000" d="M96.5018,-165.8121C115.4184,-158.3806 138.6261,-149.2632 158.0573,-141.6295"></path>
<polygon fill="#000000" stroke="#000000" points="159.5159,-144.817 167.5436,-137.9027 156.9563,-138.3017 159.5159,-144.817"></polygon>
</g>
<!-- release -->
<g id="node3" class="node">
<title>release</title>
<ellipse fill="none" stroke="#000000" cx="197.8414" cy="-180" rx="37.6755" ry="18"></ellipse>
<text text-anchor="middle" x="197.8414" y="-175.8" font-family="Times,serif" font-size="14.00" fill="#000000">release</text>
</g>
<!-- releasesleep&#45;&gt;release -->
<g id="edge2" class="edge">
<title>releasesleep-&gt;release</title>
<path fill="none" stroke="#000000" d="M118.2819,-180C128.737,-180 139.5353,-180 149.6758,-180"></path>
<polygon fill="#000000" stroke="#000000" points="149.9632,-183.5001 159.9632,-180 149.9631,-176.5001 149.9632,-183.5001"></polygon>
</g>
<!-- wakeup -->
<g id="node4" class="node">
<title>wakeup</title>
<ellipse fill="none" stroke="#000000" cx="197.8414" cy="-234" rx="41.1335" ry="18"></ellipse>
<text text-anchor="middle" x="197.8414" y="-229.8" font-family="Times,serif" font-size="14.00" fill="#000000">wakeup</text>
</g>
<!-- releasesleep&#45;&gt;wakeup -->
<g id="edge3" class="edge">
<title>releasesleep-&gt;wakeup</title>
<path fill="none" stroke="#000000" d="M96.5018,-194.1879C115.2823,-201.5659 138.2924,-210.6057 157.6373,-218.2055"></path>
<polygon fill="#000000" stroke="#000000" points="156.503,-221.5202 167.0903,-221.9192 159.0626,-215.0049 156.503,-221.5202"></polygon>
</g>
<!-- acquiresleep -->
<g id="node5" class="node">
<title>acquiresleep</title>
<ellipse fill="none" stroke="#000000" cx="60.3874" cy="-72" rx="59.0872" ry="18"></ellipse>
<text text-anchor="middle" x="60.3874" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">acquiresleep</text>
</g>
<!-- acquiresleep&#45;&gt;acquire -->
<g id="edge4" class="edge">
<title>acquiresleep-&gt;acquire</title>
<path fill="none" stroke="#000000" d="M96.8617,-86.3292C115.7765,-93.7601 138.9064,-102.8469 158.2548,-110.4481"></path>
<polygon fill="#000000" stroke="#000000" points="157.1118,-113.7594 167.6991,-114.1583 159.6714,-107.2441 157.1118,-113.7594"></polygon>
</g>
<!-- acquiresleep&#45;&gt;release -->
<g id="edge5" class="edge">
<title>acquiresleep-&gt;release</title>
<path fill="none" stroke="#000000" d="M99.6593,-85.6762C107.1286,-89.3167 114.5469,-93.7371 120.7747,-99 142.806,-117.6178 136.3135,-132.6693 156.7747,-153 159.2714,-155.4808 162.0298,-157.8632 164.9007,-160.1144"></path>
<polygon fill="#000000" stroke="#000000" points="163.0097,-163.066 173.1655,-166.0844 167.1086,-157.3916 163.0097,-163.066"></polygon>
</g>
<!-- sleep -->
<g id="node6" class="node">
<title>sleep</title>
<ellipse fill="none" stroke="#000000" cx="197.8414" cy="-18" rx="30.7558" ry="18"></ellipse>
<text text-anchor="middle" x="197.8414" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#000000">sleep</text>
</g>
<!-- acquiresleep&#45;&gt;sleep -->
<g id="edge6" class="edge">
<title>acquiresleep-&gt;sleep</title>
<path fill="none" stroke="#000000" d="M96.8617,-57.6708C117.2298,-49.669 142.4858,-39.7469 162.6442,-31.8275"></path>
<polygon fill="#000000" stroke="#000000" points="164.0592,-35.0321 172.0869,-28.1179 161.4996,-28.5168 164.0592,-35.0321"></polygon>
</g>
<!-- myproc -->
<g id="node7" class="node">
<title>myproc</title>
<ellipse fill="none" stroke="#000000" cx="197.8414" cy="-72" rx="40.5712" ry="18"></ellipse>
<text text-anchor="middle" x="197.8414" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">myproc</text>
</g>
<!-- acquiresleep&#45;&gt;myproc -->
<g id="edge7" class="edge">
<title>acquiresleep-&gt;myproc</title>
<path fill="none" stroke="#000000" d="M119.8773,-72C128.9513,-72 138.2441,-72 147.1074,-72"></path>
<polygon fill="#000000" stroke="#000000" points="147.276,-75.5001 157.276,-72 147.276,-68.5001 147.276,-75.5001"></polygon>
</g>
<!-- holdingsleep -->
<g id="node8" class="node">
<title>holdingsleep</title>
<ellipse fill="none" stroke="#000000" cx="60.3874" cy="-126" rx="60.2749" ry="18"></ellipse>
<text text-anchor="middle" x="60.3874" y="-121.8" font-family="Times,serif" font-size="14.00" fill="#000000">holdingsleep</text>
</g>
<!-- holdingsleep&#45;&gt;acquire -->
<g id="edge8" class="edge">
<title>holdingsleep-&gt;acquire</title>
<path fill="none" stroke="#000000" d="M121.0768,-126C130.0711,-126 139.2515,-126 147.9905,-126"></path>
<polygon fill="#000000" stroke="#000000" points="148.0091,-129.5001 158.009,-126 148.009,-122.5001 148.0091,-129.5001"></polygon>
</g>
<!-- holdingsleep&#45;&gt;release -->
<g id="edge9" class="edge">
<title>holdingsleep-&gt;release</title>
<path fill="none" stroke="#000000" d="M97.2225,-140.471C116.2707,-147.9542 139.5184,-157.0873 158.8673,-164.6887"></path>
<polygon fill="#000000" stroke="#000000" points="157.714,-167.996 168.3013,-168.3949 160.2736,-161.4807 157.714,-167.996"></polygon>
</g>
<!-- initsleeplock -->
<g id="node9" class="node">
<title>initsleeplock</title>
<ellipse fill="none" stroke="#000000" cx="60.3874" cy="-234" rx="60.2691" ry="18"></ellipse>
<text text-anchor="middle" x="60.3874" y="-229.8" font-family="Times,serif" font-size="14.00" fill="#000000">initsleeplock</text>
</g>
</g>
</svg>
</pre><h4 id="2-1-initsleeplock"><a class="anchor hidden-xs" href="#2-1-initsleeplock" title="2-1-initsleeplock"><span class="octicon octicon-link"></span></a>2-1. initsleeplock</h4><pre class="flow-chart"><svg height="510" version="1.1" width="163.046875" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.5px; top: -0.96875px;" viewBox="0 0 163.046875 510" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><marker id="raphael-marker-endblock33-obj69ktk" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj5gjc9" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj3gmh6" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj4mpjb" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj3cd1k" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="65.375" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,49.8359,4)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="stt" class="flowchartt" transform="matrix(1,0,0,1,49.8359,4)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Start</tspan></text><rect x="0" y="0" width="113.015625" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub1" transform="matrix(1,0,0,1,26.0156,97)"></rect><rect x="10" y="0" width="93.015625" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub1i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,26.0156,97)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub1t" class="flowchartt" transform="matrix(1,0,0,1,26.0156,97)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">initlock</tspan></text><rect x="0" y="0" width="157.046875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op1" transform="matrix(1,0,0,1,4,190)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op1t" class="flowchartt" transform="matrix(1,0,0,1,4,190)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;name = name</tspan></text><rect x="0" y="0" width="147.90625" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op2" transform="matrix(1,0,0,1,8.5703,283)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op2t" class="flowchartt" transform="matrix(1,0,0,1,8.5703,283)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;locked = 0</tspan></text><rect x="0" y="0" width="120.453125" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op3" transform="matrix(1,0,0,1,22.2969,376)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op3t" class="flowchartt" transform="matrix(1,0,0,1,22.2969,376)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;pid = 0</tspan></text><rect x="0" y="0" width="47.078125" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="e" transform="matrix(1,0,0,1,58.9844,469)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="et" class="flowchartt" transform="matrix(1,0,0,1,58.9844,469)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">End</tspan></text><path fill="none" stroke="#000000" d="M82.5234375,43C82.5234375,43,82.5234375,82.65409994125366,82.5234375,94.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj69ktk)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M82.5234375,136C82.5234375,136,82.5234375,175.65409994125366,82.5234375,187.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj5gjc9)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M82.5234375,229C82.5234375,229,82.5234375,268.65409994125366,82.5234375,280.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj3gmh6)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M82.5234375,322C82.5234375,322,82.5234375,361.65409994125366,82.5234375,373.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj4mpjb)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M82.5234375,415C82.5234375,415,82.5234375,454.65409994125366,82.5234375,466.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj3cd1k)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path></svg></pre><h4 id="2-2-acquiresleep"><a class="anchor hidden-xs" href="#2-2-acquiresleep" title="2-2-acquiresleep"><span class="octicon octicon-link"></span></a>2-2. acquiresleep</h4><pre class="flow-chart"><svg height="1096.03125" version="1.1" width="592.03125" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.5px; top: -0.96875px;" viewBox="0 0 592.03125 1096.03125" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><marker id="raphael-marker-endblock33-obj4utrf" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj35ww3" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj6n77w" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obji50yo" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objcm6wp" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objzk39m" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj8rzw4" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj367zd" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objwetcx" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objwj888" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="65.375" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,110.3203,54.0039)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="stt" class="flowchartt" transform="matrix(1,0,0,1,110.3203,54.0039)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Start</tspan></text><rect x="0" y="0" width="103.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub1" transform="matrix(1,0,0,1,91.0703,197.0078)"></rect><rect x="10" y="0" width="83.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub1i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,91.0703,197.0078)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub1t" class="flowchartt" transform="matrix(1,0,0,1,91.0703,197.0078)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">acquire</tspan></text><rect x="0" y="0" width="111.109375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op1" transform="matrix(1,0,0,1,87.4531,340.0117)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op1t" class="flowchartt" transform="matrix(1,0,0,1,87.4531,340.0117)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;locked</tspan></text><path fill="none" stroke="#000000" d="M10,19.5L0,39L94.515625,39L114.515625,0L20,0L10,19.5" stroke-width="2" font-family="'Andale Mono', monospace" id="io1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,85.75,483.0156)"></path><text x="30" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="io1t" class="flowchartt" transform="matrix(1,0,0,1,85.75,483.0156)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">result</tspan></text><path fill="none" stroke="#000000" d="M69.50390625,34.751953125L0,69.50390625L139.0078125,139.0078125L278.015625,69.50390625L139.0078125,0L0,69.50390625" stroke-width="2" font-family="'Andale Mono', monospace" id="cond1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,4,576.0156)"></path><text x="74.50390625" y="69.50390625" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="cond1t" class="flowchartt" transform="matrix(1,0,0,1,4,576.0156)" stroke-width="1"><tspan dy="5.50390625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">if result is true</tspan></text><rect x="0" y="0" width="85.578125" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub2" transform="matrix(1,0,0,1,100.2188,819.0273)"></rect><rect x="10" y="0" width="65.578125" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub2i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,100.2188,819.0273)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub2t" class="flowchartt" transform="matrix(1,0,0,1,100.2188,819.0273)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">sleep</tspan></text><rect x="0" y="0" width="147.90625" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op2" transform="matrix(1,0,0,1,401.0703,626.0195)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op2t" class="flowchartt" transform="matrix(1,0,0,1,401.0703,626.0195)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;locked = 1</tspan></text><rect x="0" y="0" width="230.015625" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op3" transform="matrix(1,0,0,1,360.0156,769.0234)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op3t" class="flowchartt" transform="matrix(1,0,0,1,360.0156,769.0234)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;pid = myproc()−&gt;pid</tspan></text><rect x="0" y="0" width="103.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub3" transform="matrix(1,0,0,1,423.0859,912.0273)"></rect><rect x="10" y="0" width="83.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub3i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,423.0859,912.0273)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub3t" class="flowchartt" transform="matrix(1,0,0,1,423.0859,912.0273)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">release</tspan></text><rect x="0" y="0" width="47.078125" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="e" transform="matrix(1,0,0,1,451.4844,1055.0313)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="et" class="flowchartt" transform="matrix(1,0,0,1,451.4844,1055.0313)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">End</tspan></text><path fill="none" stroke="#000000" d="M143.0078125,93.00390625C143.0078125,93.00390625,143.0078125,176.95481324195862,143.0078125,194.0073412247002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj4utrf)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M143.0078125,236.0078125C143.0078125,236.0078125,143.0078125,319.9587194919586,143.0078125,337.0112474747002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj35ww3)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M143.0078125,379.01171875C143.0078125,379.01171875,143.0078125,462.9626257419586,143.0078125,480.0151537247002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj6n77w)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M143.0078125,522.015625C143.0078125,522.015625,143.0078125,561.6697249412537,143.0078125,573.0160640846007" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obji50yo)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M143.0078125,715.0234375C143.0078125,715.0234375,143.0078125,798.9743444919586,143.0078125,816.0268724747002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objcm6wp)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="148.0078125" y="725.0234375" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.5078125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">yes</tspan></text><path fill="none" stroke="#000000" d="M282.015625,645.51953125C282.015625,645.51953125,379.5833221003413,645.51953125,398.0678272150544,645.51953125" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objzk39m)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><text x="287.015625" y="635.51953125" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" stroke-width="1"><tspan dy="5.50390625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">no</tspan></text><path fill="none" stroke="#000000" d="M185.796875,838.52734375C185.796875,838.52734375,210.796875,838.52734375,210.796875,838.52734375C210.796875,838.52734375,210.796875,315.01171875,210.796875,315.01171875C210.796875,315.01171875,143.0078125,315.01171875,143.0078125,315.01171875C143.0078125,315.01171875,143.0078125,330.38516330718994,143.0078125,337.02096652425826" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj8rzw4)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M475.0234375,665.01953125C475.0234375,665.01953125,475.0234375,748.9704382419586,475.0234375,766.0229662247002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj367zd)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M475.0234375,808.0234375C475.0234375,808.0234375,475.0234375,891.9743444919586,475.0234375,909.0268724747002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objwetcx)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M475.0234375,951.02734375C475.0234375,951.02734375,475.0234375,1034.9782507419586,475.0234375,1052.0307787247002" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objwj888)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path></svg></pre><h4 id="2-3-releasesleep"><a class="anchor hidden-xs" href="#2-3-releasesleep" title="2-3-releasesleep"><span class="octicon octicon-link"></span></a>2-3. releasesleep</h4><pre class="flow-chart"><svg height="603" version="1.1" width="153.90625" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.5px; top: -0.96875px;" viewBox="0 0 153.90625 603" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><marker id="raphael-marker-endblock33-obj9xkxi" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj7g5v5" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj07sli" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objfvxdh" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objid3ld" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objs30w3" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="65.375" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,45.2656,4)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="stt" class="flowchartt" transform="matrix(1,0,0,1,45.2656,4)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Start</tspan></text><rect x="0" y="0" width="103.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub1" transform="matrix(1,0,0,1,26.0156,97)"></rect><rect x="10" y="0" width="83.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub1i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,26.0156,97)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub1t" class="flowchartt" transform="matrix(1,0,0,1,26.0156,97)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">acquire</tspan></text><rect x="0" y="0" width="147.90625" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op1" transform="matrix(1,0,0,1,4,190)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op1t" class="flowchartt" transform="matrix(1,0,0,1,4,190)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;locked = 0</tspan></text><rect x="0" y="0" width="129.40625" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op2" transform="matrix(1,0,0,1,13.25,283)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op2t" class="flowchartt" transform="matrix(1,0,0,1,13.25,283)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">lk−&gt;pid = 0;</tspan></text><rect x="0" y="0" width="94.734375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub2" transform="matrix(1,0,0,1,30.5859,376)"></rect><rect x="10" y="0" width="74.734375" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub2i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,30.5859,376)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub2t" class="flowchartt" transform="matrix(1,0,0,1,30.5859,376)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">wakeup</tspan></text><rect x="0" y="0" width="103.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub3" transform="matrix(1,0,0,1,26.0156,469)"></rect><rect x="10" y="0" width="83.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub3i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,26.0156,469)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub3t" class="flowchartt" transform="matrix(1,0,0,1,26.0156,469)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">release</tspan></text><rect x="0" y="0" width="47.078125" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="e" transform="matrix(1,0,0,1,54.4141,562)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="et" class="flowchartt" transform="matrix(1,0,0,1,54.4141,562)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">End</tspan></text><path fill="none" stroke="#000000" d="M77.953125,43C77.953125,43,77.953125,82.65409994125366,77.953125,94.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj9xkxi)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M77.953125,136C77.953125,136,77.953125,175.65409994125366,77.953125,187.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj7g5v5)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M77.953125,229C77.953125,229,77.953125,268.65409994125366,77.953125,280.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj07sli)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M77.953125,322C77.953125,322,77.953125,361.65409994125366,77.953125,373.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objfvxdh)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M77.953125,415C77.953125,415,77.953125,454.65409994125366,77.953125,466.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objid3ld)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M77.953125,508C77.953125,508,77.953125,547.6540999412537,77.953125,559.0004390846007" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objs30w3)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path></svg></pre><h4 id="2-4-holdingsleep"><a class="anchor hidden-xs" href="#2-4-holdingsleep" title="2-4-holdingsleep"><span class="octicon octicon-link"></span></a>2-4. holdingsleep</h4><pre class="flow-chart"><svg height="510" version="1.1" width="153.703125" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.5px; top: -0.96875px;" viewBox="0 0 153.703125 510" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><marker id="raphael-marker-endblock33-objfb5zo" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj8755u" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objnqnjd" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj3umsv" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objkzj97" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="black" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="65.375" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="st" transform="matrix(1,0,0,1,45.1641,4)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="stt" class="flowchartt" transform="matrix(1,0,0,1,45.1641,4)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Start</tspan></text><rect x="0" y="0" width="103.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub1" transform="matrix(1,0,0,1,25.9141,97)"></rect><rect x="10" y="0" width="83.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub1i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,25.9141,97)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub1t" class="flowchartt" transform="matrix(1,0,0,1,25.9141,97)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">acquire</tspan></text><rect x="0" y="0" width="147.703125" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="op1" transform="matrix(1,0,0,1,4,190)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="op1t" class="flowchartt" transform="matrix(1,0,0,1,4,190)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">r = lk−&gt;locked</tspan></text><rect x="0" y="0" width="103.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="sub2" transform="matrix(1,0,0,1,25.9141,283)"></rect><rect x="10" y="0" width="83.875" height="39" rx="0" ry="0" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" stroke-width="2" id="sub2i" font-family="'Andale Mono', monospace" transform="matrix(1,0,0,1,25.9141,283)"></rect><text x="20" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="sub2t" class="flowchartt" transform="matrix(1,0,0,1,25.9141,283)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">release</tspan></text><path fill="none" stroke="#000000" d="M10,19.5L0,39L113.015625,39L133.015625,0L20,0L10,19.5" stroke-width="2" font-family="'Andale Mono', monospace" id="io1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;" transform="matrix(1,0,0,1,11.3438,376)"></path><text x="30" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="io1t" class="flowchartt" transform="matrix(1,0,0,1,11.3438,376)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">output r</tspan></text><rect x="0" y="0" width="47.078125" height="39" rx="20" ry="20" fill="none" stroke="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="2" class="flowchart" id="e" transform="matrix(1,0,0,1,54.3125,469)"></rect><text x="10" y="19.5" text-anchor="start" font-family="'Andale Mono', monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;" id="et" class="flowchartt" transform="matrix(1,0,0,1,54.3125,469)" stroke-width="1"><tspan dy="5.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">End</tspan></text><path fill="none" stroke="#000000" d="M77.8515625,43C77.8515625,43,77.8515625,82.65409994125366,77.8515625,94.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objfb5zo)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M77.8515625,136C77.8515625,136,77.8515625,175.65409994125366,77.8515625,187.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj8755u)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M77.8515625,229C77.8515625,229,77.8515625,268.65409994125366,77.8515625,280.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objnqnjd)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M77.8515625,322C77.8515625,322,77.8515625,361.65409994125366,77.8515625,373.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-obj3umsv)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path><path fill="none" stroke="#000000" d="M77.8515625,415C77.8515625,415,77.8515625,454.65409994125366,77.8515625,466.00043908460066" stroke-width="2" marker-end="url(#raphael-marker-endblock33-objkzj97)" font-family="'Andale Mono', monospace" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: &quot;Andale Mono&quot;, monospace;"></path></svg></pre><h2 id="三、程式碼解釋與資料結構"><a class="anchor hidden-xs" href="#三、程式碼解釋與資料結構" title="三、程式碼解釋與資料結構"><span class="octicon octicon-link"></span></a>三、程式碼解釋與資料結構</h2><h3 id="1-spinlockh"><a class="anchor hidden-xs" href="#1-spinlockh" title="1-spinlockh"><span class="octicon octicon-link"></span></a>1. spinlock.h</h3><pre><code class="c hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="1"></span>
<span data-linenumber="2"></span>
<span data-linenumber="3"></span>
<span data-linenumber="4"></span>
<span data-linenumber="5"></span>
<span data-linenumber="6"></span>
<span data-linenumber="7"></span>
<span data-linenumber="8"></span>
<span data-linenumber="9"></span>
<span data-linenumber="10"></span>
<span data-linenumber="11"></span>
<span data-linenumber="12"></span>
<span data-linenumber="13"></span>
<span data-linenumber="14"></span></div><div class="code"><span class="hljs-comment">// 定義spinlock的結構</span>
<span class="hljs-keyword">struct</span> spinlock {
  <span class="hljs-comment">// lock是否被佔用，0表未被佔用，1表正被佔用，資料型態為uint</span>
  <span class="hljs-keyword">uint</span> locked;
  
  <span class="hljs-comment">// Debug使用</span>
  <span class="hljs-comment">// lock的名稱，資料型態為char</span>
  <span class="hljs-keyword">char</span> *name;
  <span class="hljs-comment">// cpu結構</span>
  <span class="hljs-keyword">struct</span> cpu *cpu;
  
  <span class="hljs-comment">// 程式計數器，以堆疊表示，資料型態為unit陣列</span>
  <span class="hljs-keyword">uint</span> pcs[<span class="hljs-number">10</span>];
};
</div></div></code></pre><blockquote style="border-left-color: rgb(144, 123, 247);">
<p>中斷可能會造成(Deadlock)死結，因此spinlock機制需要做中斷處理(Interrupt Handlers)，確保行程進入臨界區段時是中斷禁止的。在acquire與release方法中會分別以pushcli及popcli方法去紀錄與控制是否允許中斷。<span class="color" data-color="#907bf7"></span></p>
</blockquote><h3 id="2-spinlockc"><a class="anchor hidden-xs" href="#2-spinlockc" title="2-spinlockc"><span class="octicon octicon-link"></span></a>2. spinlock.c</h3><pre><code class="c hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="1"></span>
<span data-linenumber="2"></span>
<span data-linenumber="3"></span>
<span data-linenumber="4"></span>
<span data-linenumber="5"></span>
<span data-linenumber="6"></span>
<span data-linenumber="7"></span>
<span data-linenumber="8"></span>
<span data-linenumber="9"></span>
<span data-linenumber="10"></span>
<span data-linenumber="11"></span>
<span data-linenumber="12"></span>
<span data-linenumber="13"></span>
<span data-linenumber="14"></span>
<span data-linenumber="15"></span>
<span data-linenumber="16"></span>
<span data-linenumber="17"></span>
<span data-linenumber="18"></span>
<span data-linenumber="19"></span>
<span data-linenumber="20"></span>
<span data-linenumber="21"></span>
<span data-linenumber="22"></span>
<span data-linenumber="23"></span>
<span data-linenumber="24"></span>
<span data-linenumber="25"></span>
<span data-linenumber="26"></span>
<span data-linenumber="27"></span>
<span data-linenumber="28"></span>
<span data-linenumber="29"></span>
<span data-linenumber="30"></span>
<span data-linenumber="31"></span>
<span data-linenumber="32"></span>
<span data-linenumber="33"></span>
<span data-linenumber="34"></span>
<span data-linenumber="35"></span>
<span data-linenumber="36"></span>
<span data-linenumber="37"></span>
<span data-linenumber="38"></span>
<span data-linenumber="39"></span>
<span data-linenumber="40"></span>
<span data-linenumber="41"></span>
<span data-linenumber="42"></span>
<span data-linenumber="43"></span>
<span data-linenumber="44"></span>
<span data-linenumber="45"></span>
<span data-linenumber="46"></span>
<span data-linenumber="47"></span>
<span data-linenumber="48"></span>
<span data-linenumber="49"></span>
<span data-linenumber="50"></span>
<span data-linenumber="51"></span>
<span data-linenumber="52"></span>
<span data-linenumber="53"></span>
<span data-linenumber="54"></span>
<span data-linenumber="55"></span>
<span data-linenumber="56"></span>
<span data-linenumber="57"></span>
<span data-linenumber="58"></span>
<span data-linenumber="59"></span>
<span data-linenumber="60"></span>
<span data-linenumber="61"></span>
<span data-linenumber="62"></span>
<span data-linenumber="63"></span>
<span data-linenumber="64"></span>
<span data-linenumber="65"></span>
<span data-linenumber="66"></span>
<span data-linenumber="67"></span>
<span data-linenumber="68"></span>
<span data-linenumber="69"></span>
<span data-linenumber="70"></span>
<span data-linenumber="71"></span>
<span data-linenumber="72"></span>
<span data-linenumber="73"></span>
<span data-linenumber="74"></span>
<span data-linenumber="75"></span>
<span data-linenumber="76"></span>
<span data-linenumber="77"></span>
<span data-linenumber="78"></span>
<span data-linenumber="79"></span>
<span data-linenumber="80"></span>
<span data-linenumber="81"></span>
<span data-linenumber="82"></span>
<span data-linenumber="83"></span>
<span data-linenumber="84"></span>
<span data-linenumber="85"></span>
<span data-linenumber="86"></span>
<span data-linenumber="87"></span>
<span data-linenumber="88"></span>
<span data-linenumber="89"></span>
<span data-linenumber="90"></span>
<span data-linenumber="91"></span>
<span data-linenumber="92"></span>
<span data-linenumber="93"></span>
<span data-linenumber="94"></span>
<span data-linenumber="95"></span>
<span data-linenumber="96"></span>
<span data-linenumber="97"></span>
<span data-linenumber="98"></span>
<span data-linenumber="99"></span>
<span data-linenumber="100"></span>
<span data-linenumber="101"></span>
<span data-linenumber="102"></span>
<span data-linenumber="103"></span>
<span data-linenumber="104"></span>
<span data-linenumber="105"></span>
<span data-linenumber="106"></span>
<span data-linenumber="107"></span>
<span data-linenumber="108"></span>
<span data-linenumber="109"></span>
<span data-linenumber="110"></span>
<span data-linenumber="111"></span>
<span data-linenumber="112"></span>
<span data-linenumber="113"></span>
<span data-linenumber="114"></span>
<span data-linenumber="115"></span>
<span data-linenumber="116"></span>
<span data-linenumber="117"></span>
<span data-linenumber="118"></span>
<span data-linenumber="119"></span>
<span data-linenumber="120"></span>
<span data-linenumber="121"></span>
<span data-linenumber="122"></span>
<span data-linenumber="123"></span>
<span data-linenumber="124"></span>
<span data-linenumber="125"></span>
<span data-linenumber="126"></span>
<span data-linenumber="127"></span>
<span data-linenumber="128"></span>
<span data-linenumber="129"></span>
<span data-linenumber="130"></span>
<span data-linenumber="131"></span>
<span data-linenumber="132"></span>
<span data-linenumber="133"></span>
<span data-linenumber="134"></span>
<span data-linenumber="135"></span>
<span data-linenumber="136"></span>
<span data-linenumber="137"></span>
<span data-linenumber="138"></span>
<span data-linenumber="139"></span>
<span data-linenumber="140"></span>
<span data-linenumber="141"></span>
<span data-linenumber="142"></span>
<span data-linenumber="143"></span>
<span data-linenumber="144"></span>
<span data-linenumber="145"></span>
<span data-linenumber="146"></span></div><div class="code"><span class="hljs-comment">// 引入resource</span>
<span class="hljs-meta">#include "types.h"</span>
<span class="hljs-meta">#include "defs.h"</span>
<span class="hljs-meta">#include "param.h"</span>
<span class="hljs-meta">#include "x86.h"</span>
<span class="hljs-meta">#include "memlayout.h"</span>
<span class="hljs-meta">#include "mmu.h"</span>
<span class="hljs-meta">#include "proc.h"</span>
<span class="hljs-meta">#include "spinlock.h"</span>

<span class="hljs-comment">// 初始化lock</span>
<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">initlock</span>(<span class="hljs-params"><span class="hljs-keyword">struct</span> spinlock *lk, <span class="hljs-keyword">char</span> *name</span>)
</span>{
  <span class="hljs-comment">// 賦予初值</span>
  lk−&gt;name = name;
  lk−&gt;locked = <span class="hljs-number">0</span>;
  lk−&gt;cpu = <span class="hljs-number">0</span>;
}

<span class="hljs-comment">// 獲取lock</span>
<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">acquire</span>(<span class="hljs-params"><span class="hljs-keyword">struct</span> spinlock *lk</span>)
</span>{
  <span class="hljs-comment">// 執行不允許中斷，目的是避免死結，並加入堆疊紀錄</span>
  pushcli();
  <span class="hljs-comment">// 若lock正被CPU佔用</span>
  <span class="hljs-keyword">if</span>(holding(lk))
    <span class="hljs-comment">// 中斷流程，並回傳訊息</span>
    panic(<span class="hljs-string">"acquire"</span>);

  <span class="hljs-comment">// 以迭代確認結構變數lk的locked成員值是否為1，確保不可分割</span>
  <span class="hljs-comment">// 若回傳1代表lock正被CPU佔用，則繼續跑迴圈做等待</span>
  <span class="hljs-comment">// 若回傳0則代表可以進行acquire，並將值設為1</span>
  <span class="hljs-keyword">while</span>(xchg(&amp;lk−&gt;locked, <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>)
    ;

  <span class="hljs-comment">// 在Compiler做編譯時有可能因為最佳化而改變了Assembly的順序</span>
  <span class="hljs-comment">// 此為Memory Barrier的技術，目的是確保順序性</span>
  __sync_synchronize();

  <span class="hljs-comment">// Debug使用</span>
  <span class="hljs-comment">// 將結構變數lk的cpu成員值設為當前cpu</span>
  lk−&gt;cpu = mycpu();
  <span class="hljs-comment">// 紀錄程式計數器</span>
  getcallerpcs(&amp;lk, lk−&gt;pcs);
}

<span class="hljs-comment">// 釋放lock</span>
<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">release</span>(<span class="hljs-params"><span class="hljs-keyword">struct</span> spinlock *lk</span>)
</span>{
  <span class="hljs-comment">// 若lock未被佔用</span>
  <span class="hljs-keyword">if</span>(!holding(lk))
    <span class="hljs-comment">// 中斷流程，並回傳訊息</span>
    panic(<span class="hljs-string">"release"</span>);

  <span class="hljs-comment">// 復原為初值</span>
  lk−&gt;pcs[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;
  lk−&gt;cpu = <span class="hljs-number">0</span>;

  <span class="hljs-comment">// 在Compiler做編譯時有可能因為最佳化而改變了Assembly的順序</span>
  <span class="hljs-comment">// 此為Memory Barrier的技術，目的是確保順序性</span>
  __sync_synchronize();

  <span class="hljs-comment">// 此為Inline Assembly語法，代表針對記憶體的讀寫，將結構變數lk的locked成員值指定為0</span>
  <span class="hljs-function">asm <span class="hljs-title">volatile</span>(<span class="hljs-params"><span class="hljs-string">"movl $0, %0"</span> : <span class="hljs-string">"+m"</span> (lk−&gt;locked</span>) : )</span>;

  <span class="hljs-comment">// 執行允許中斷，並取出堆疊紀錄</span>
  popcli();
}

<span class="hljs-comment">// 紀錄程式計數器</span>
<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">getcallerpcs</span>(<span class="hljs-params"><span class="hljs-keyword">void</span> *v, <span class="hljs-keyword">uint</span> pcs[]</span>)
</span>{
  <span class="hljs-comment">// 宣告ebp指標變數</span>
  <span class="hljs-keyword">uint</span> *ebp;
  <span class="hljs-comment">// 宣告紀錄索引位置的變數</span>
  <span class="hljs-keyword">int</span> i;

  <span class="hljs-comment">// 取得ebp</span>
  ebp = (<span class="hljs-keyword">uint</span>*)v − <span class="hljs-number">2</span>;
  <span class="hljs-comment">// 迭代程式計數器陣列</span>
  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++){
    <span class="hljs-comment">// 若ebp不在範圍內，則跳出迴圈</span>
    <span class="hljs-keyword">if</span>(ebp == <span class="hljs-number">0</span> || ebp &lt; (<span class="hljs-keyword">uint</span>*)KERNBASE || ebp == (<span class="hljs-keyword">uint</span>*)<span class="hljs-number">0xffffffff</span>)
      <span class="hljs-keyword">break</span>;
    <span class="hljs-comment">// 儲存CPU下次要執行的eip</span>
    pcs[i] = ebp[<span class="hljs-number">1</span>];
    <span class="hljs-comment">// 儲存ebp</span>
    ebp = (<span class="hljs-keyword">uint</span>*)ebp[<span class="hljs-number">0</span>];
  }
  <span class="hljs-comment">// 將剩餘空間設為0</span>
  <span class="hljs-keyword">for</span>(; i &lt; <span class="hljs-number">10</span>; i++)
    pcs[i] = <span class="hljs-number">0</span>;
}

<span class="hljs-comment">// 檢查CPU是否佔用lock</span>
<span class="hljs-function"><span class="hljs-keyword">int</span>
<span class="hljs-title">holding</span>(<span class="hljs-params"><span class="hljs-keyword">struct</span> spinlock *<span class="hljs-keyword">lock</span></span>)
</span>{
  <span class="hljs-comment">// 結構變數lock的locked成員狀態為被佔用，且cpu成員與當前CPU一致</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">lock</span>−&gt;locked &amp;&amp; <span class="hljs-keyword">lock</span>−&gt;cpu == mycpu();
}

<span class="hljs-comment">// 加入堆疊</span>
<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">pushcli</span>(<span class="hljs-params"><span class="hljs-keyword">void</span></span>)
</span>{
  <span class="hljs-comment">// 宣告紀錄是否中斷的變數</span>
  <span class="hljs-keyword">int</span> eflags;

  <span class="hljs-comment">// 取得當前狀態</span>
  eflags = readeflags();
  <span class="hljs-comment">// 執行中斷禁止</span>
  cli();
  <span class="hljs-comment">// 結構變數cpu的ncli成員，代表堆疊的深度</span>
  <span class="hljs-comment">// 若深度為0</span>
  <span class="hljs-keyword">if</span>(mycpu()−&gt;ncli == <span class="hljs-number">0</span>)
    <span class="hljs-comment">// FL_IF為一常數，代表允許中斷</span>
    <span class="hljs-comment">// 結構變數cpu的intena成員，代表在加入堆疊前，是否為允許中斷</span>
    <span class="hljs-comment">// 將intena的值設為允許中斷</span>
    mycpu()−&gt;intena = eflags &amp; FL_IF;
  <span class="hljs-comment">// 堆疊深度加一</span>
  mycpu()−&gt;ncli += <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// 取出堆疊</span>
<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">popcli</span>(<span class="hljs-params"><span class="hljs-keyword">void</span></span>)
</span>{
  <span class="hljs-comment">// 取出當前狀態，並判斷是否已為允許中斷</span>
  <span class="hljs-keyword">if</span>(readeflags()&amp;FL_IF)
    <span class="hljs-comment">// 中斷流程，並回傳訊息</span>
    panic(<span class="hljs-string">"popcli − interruptible"</span>);
  <span class="hljs-comment">// 堆疊深度減一</span>
  <span class="hljs-comment">// 若深度小於0，代表堆疊本來就已空</span>
  <span class="hljs-keyword">if</span>(−−mycpu()−&gt;ncli &lt; <span class="hljs-number">0</span>)
    <span class="hljs-comment">// 中斷流程，並回傳訊息</span>
    panic(<span class="hljs-string">"popcli"</span>);
  <span class="hljs-comment">// 若堆疊深度為0，且當前為允許中斷</span>
  <span class="hljs-keyword">if</span>(mycpu()−&gt;ncli == <span class="hljs-number">0</span> &amp;&amp; mycpu()−&gt;intena)
    <span class="hljs-comment">// 執行允許中斷</span>
    sti();
}
</div></div></code></pre><h3 id="3-sleeplockh"><a class="anchor hidden-xs" href="#3-sleeplockh" title="3-sleeplockh"><span class="octicon octicon-link"></span></a>3. sleeplock.h</h3><pre><code class="c hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="1"></span>
<span data-linenumber="2"></span>
<span data-linenumber="3"></span>
<span data-linenumber="4"></span>
<span data-linenumber="5"></span>
<span data-linenumber="6"></span>
<span data-linenumber="7"></span>
<span data-linenumber="8"></span>
<span data-linenumber="9"></span>
<span data-linenumber="10"></span>
<span data-linenumber="11"></span>
<span data-linenumber="12"></span>
<span data-linenumber="13"></span>
<span data-linenumber="14"></span>
<span data-linenumber="15"></span>
<span data-linenumber="16"></span>
<span data-linenumber="17"></span>
<span data-linenumber="18"></span>
<span data-linenumber="19"></span></div><div class="code"><span class="hljs-comment">// 定義sleeplock的結構</span>
<span class="hljs-keyword">struct</span> sleeplock {
  <span class="hljs-comment">// lock是否被佔用，0表未被佔用，1表正被佔用，資料型態為uint</span>
  <span class="hljs-keyword">uint</span> locked;
  <span class="hljs-comment">// spinlock結構</span>
  <span class="hljs-keyword">struct</span> spinlock lk;

  <span class="hljs-comment">// Debug使用</span>
  <span class="hljs-comment">// lock的名稱，資料型態為char</span>
  <span class="hljs-keyword">char</span> *name;
  <span class="hljs-comment">// 佔用lock的行程id，資料型態為int</span>
  <span class="hljs-keyword">int</span> pid;
};

<span class="hljs-comment">// 定義常數</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> O_RDONLY 0x000</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> O_WRONLY 0x001</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> O_RDWR 0x002</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> O_CREATE 0x200</span>
</div></div></code></pre><blockquote style="border-left-color: rgb(144, 123, 247);">
<p>在檔案系統做讀寫時，CPU可能會佔用lock較長的時間，而其他想要進入臨界區段的行程只能一直做等待，sleeplock的機制讓CPU排程器可以從就緒佇列選出其他的行程執行，行程就不會因為忙碌等代而浪費CPU資源。<span class="color" data-color="#907bf7"></span></p>
</blockquote><h3 id="4-sleeplockc"><a class="anchor hidden-xs" href="#4-sleeplockc" title="4-sleeplockc"><span class="octicon octicon-link"></span></a>4. sleeplock.c</h3><pre><code class="c hljs"><div class="wrapper"><div class="gutter linenumber"><span data-linenumber="1"></span>
<span data-linenumber="2"></span>
<span data-linenumber="3"></span>
<span data-linenumber="4"></span>
<span data-linenumber="5"></span>
<span data-linenumber="6"></span>
<span data-linenumber="7"></span>
<span data-linenumber="8"></span>
<span data-linenumber="9"></span>
<span data-linenumber="10"></span>
<span data-linenumber="11"></span>
<span data-linenumber="12"></span>
<span data-linenumber="13"></span>
<span data-linenumber="14"></span>
<span data-linenumber="15"></span>
<span data-linenumber="16"></span>
<span data-linenumber="17"></span>
<span data-linenumber="18"></span>
<span data-linenumber="19"></span>
<span data-linenumber="20"></span>
<span data-linenumber="21"></span>
<span data-linenumber="22"></span>
<span data-linenumber="23"></span>
<span data-linenumber="24"></span>
<span data-linenumber="25"></span>
<span data-linenumber="26"></span>
<span data-linenumber="27"></span>
<span data-linenumber="28"></span>
<span data-linenumber="29"></span>
<span data-linenumber="30"></span>
<span data-linenumber="31"></span>
<span data-linenumber="32"></span>
<span data-linenumber="33"></span>
<span data-linenumber="34"></span>
<span data-linenumber="35"></span>
<span data-linenumber="36"></span>
<span data-linenumber="37"></span>
<span data-linenumber="38"></span>
<span data-linenumber="39"></span>
<span data-linenumber="40"></span>
<span data-linenumber="41"></span>
<span data-linenumber="42"></span>
<span data-linenumber="43"></span>
<span data-linenumber="44"></span>
<span data-linenumber="45"></span>
<span data-linenumber="46"></span>
<span data-linenumber="47"></span>
<span data-linenumber="48"></span>
<span data-linenumber="49"></span>
<span data-linenumber="50"></span>
<span data-linenumber="51"></span>
<span data-linenumber="52"></span>
<span data-linenumber="53"></span>
<span data-linenumber="54"></span>
<span data-linenumber="55"></span>
<span data-linenumber="56"></span>
<span data-linenumber="57"></span>
<span data-linenumber="58"></span>
<span data-linenumber="59"></span>
<span data-linenumber="60"></span>
<span data-linenumber="61"></span>
<span data-linenumber="62"></span>
<span data-linenumber="63"></span>
<span data-linenumber="64"></span>
<span data-linenumber="65"></span>
<span data-linenumber="66"></span>
<span data-linenumber="67"></span>
<span data-linenumber="68"></span>
<span data-linenumber="69"></span>
<span data-linenumber="70"></span>
<span data-linenumber="71"></span>
<span data-linenumber="72"></span>
<span data-linenumber="73"></span></div><div class="code"><span class="hljs-comment">// 引入resource</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"types.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"defs.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"param.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"x86.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"memlayout.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"mmu.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"proc.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"spinlock.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"sleeplock.h"</span></span>

<span class="hljs-comment">// 初始化sleeplock</span>
<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">initsleeplock</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> sleeplock *lk, <span class="hljs-keyword">char</span> *name)</span>
</span>{
  <span class="hljs-comment">// 初始化spinlock</span>
  initlock(&amp;lk−&gt;lk, <span class="hljs-string">"sleep lock"</span>);
  <span class="hljs-comment">// 賦予初值</span>
  lk−&gt;name = name;
  lk−&gt;locked = <span class="hljs-number">0</span>;
  lk−&gt;pid = <span class="hljs-number">0</span>;
}

<span class="hljs-comment">// 獲取sleeplock</span>
<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">acquiresleep</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> sleeplock *lk)</span>
</span>{
  <span class="hljs-comment">// 獲取spinlock</span>
  acquire(&amp;lk−&gt;lk);
  <span class="hljs-comment">// 以迭代檢查lock是否正被佔用</span>
  <span class="hljs-keyword">while</span> (lk−&gt;locked) {
    <span class="hljs-comment">// 若是則先進入睡眠</span>
    sleep(lk, &amp;lk−&gt;lk);
  }
  <span class="hljs-comment">// 將結構變數lk的locked成員值設為1</span>
  lk−&gt;locked = <span class="hljs-number">1</span>;
  <span class="hljs-comment">// 將結構變數lk的pid成員值設為當前的行程id</span>
  lk−&gt;pid = myproc()−&gt;pid;
  <span class="hljs-comment">// 釋放spinlock</span>
  release(&amp;lk−&gt;lk);
}

<span class="hljs-comment">// 釋放sleeplock</span>
<span class="hljs-function"><span class="hljs-keyword">void</span>
<span class="hljs-title">releasesleep</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> sleeplock *lk)</span>
</span>{
  <span class="hljs-comment">// 獲取spinlock</span>
  acquire(&amp;lk−&gt;lk);
  <span class="hljs-comment">// 復原為初值</span>
  lk−&gt;locked = <span class="hljs-number">0</span>;
  lk−&gt;pid = <span class="hljs-number">0</span>;
  <span class="hljs-comment">// 叫醒在睡眠的行程</span>
  wakeup(lk);
  <span class="hljs-comment">// 釋放spinlock  </span>
  release(&amp;lk−&gt;lk);
}

<span class="hljs-comment">// 檢查CPU是否佔用sleeplock</span>
<span class="hljs-function"><span class="hljs-keyword">int</span>
<span class="hljs-title">holdingsleep</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> sleeplock *lk)</span>
</span>{
  <span class="hljs-comment">// 宣告lock是否被佔用的變數</span>
  <span class="hljs-keyword">int</span> r;
  
  <span class="hljs-comment">// 獲取spinlock</span>
  acquire(&amp;lk−&gt;lk);
  <span class="hljs-comment">// 取得當前是否被佔用</span>
  r = lk−&gt;locked;
  <span class="hljs-comment">// 釋放spinlock  </span>
  release(&amp;lk−&gt;lk);
  <span class="hljs-comment">// 回傳結果</span>
  <span class="hljs-keyword">return</span> r;
}
</div></div></code></pre></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav"><li class=""><a href="#報告主題：chapter-4-locking">報告主題：Chapter 4. Locking</a><ul class="nav"><li class=""><a href="#一、運作原理">一、運作原理</a><ul class="nav"><li class=""><a href="#1-前言">1. 前言</a></li><li class=""><a href="#2-原理">2. 原理</a></li></ul></li><li class=""><a href="#二、程式流程與方法關聯">二、程式流程與方法關聯</a><ul class="nav"><li class=""><a href="#1-spinlockc">1. spinlock.c</a></li><li class=""><a href="#2-sleeplockc">2. sleeplock.c</a></li></ul></li><li class=""><a href="#三、程式碼解釋與資料結構">三、程式碼解釋與資料結構</a><ul class="nav"><li class=""><a href="#1-spinlockh">1. spinlock.h</a></li><li class=""><a href="#2-spinlockc">2. spinlock.c</a></li><li class=""><a href="#3-sleeplockh">3. sleeplock.h</a></li><li class=""><a href="#4-sleeplockc">4. sleeplock.c</a></li></ul></li></ul></li></ul></div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;"  >
        <div class="toc"><ul class="nav"><li class=""><a href="#報告主題：chapter-4-locking">報告主題：Chapter 4. Locking</a><ul class="nav"><li class=""><a href="#一、運作原理">一、運作原理</a><ul class="nav"><li class=""><a href="#1-前言">1. 前言</a></li><li class=""><a href="#2-原理">2. 原理</a></li></ul></li><li class=""><a href="#二、程式流程與方法關聯">二、程式流程與方法關聯</a><ul class="nav"><li class=""><a href="#1-spinlockc">1. spinlock.c</a></li><li class=""><a href="#2-sleeplockc">2. sleeplock.c</a></li></ul></li><li class=""><a href="#三、程式碼解釋與資料結構">三、程式碼解釋與資料結構</a><ul class="nav"><li class=""><a href="#1-spinlockh">1. spinlock.h</a></li><li class=""><a href="#2-spinlockc">2. spinlock.c</a></li><li class=""><a href="#3-sleeplockh">3. sleeplock.h</a></li><li class=""><a href="#4-sleeplockc">4. sleeplock.c</a></li></ul></li></ul></li></ul></div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
